<!DOCTYPE html>
<html>
<head>
    <title>InstrumentationAdapter - ByteHot Documentation</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div class="navigation">
    <a href="../index.html">üè† Home</a>
    <a href="../implementation.html">üèóÔ∏è Implementation</a>
    <a href="../journal.html">üìî Journal</a>
    <a href="../docs/">üìö Docs</a>
    <a href="../javadocs/">üìñ Javadocs</a>
    <a href="https://github.com/rydnr/bytehot">üîó GitHub</a>
</div>
<main>
<h1 id="overview">Overview</h1>
<p>The <code>InstrumentationAdapter</code> class provides the
infrastructure implementation of the <code>InstrumentationPort</code>
interface, serving as the critical bridge between ByteHot's domain logic
and the JVM's instrumentation capabilities. This adapter handles the
accidental complexity of interacting with Java's
<code>java.lang.instrument</code> package while exposing a clean,
domain-focused interface for class redefinition and bytecode
manipulation operations.</p>
<h1 id="hexagonal-architecture-role">Hexagonal Architecture Role</h1>
<h2 id="secondary-adapter-implementation">Secondary Adapter
Implementation</h2>
<p>InstrumentationAdapter serves as a secondary adapter in ByteHot's
hexagonal architecture:</p>
<ul>
<li>Implements the <code>InstrumentationPort</code> interface defined in
the domain layer</li>
<li>Handles JVM-specific instrumentation implementation details</li>
<li>Isolates domain logic from Java instrumentation API evolution</li>
<li>Provides concrete implementation for hot-swap operations</li>
</ul>
<h2 id="technology-abstraction-boundary">Technology Abstraction
Boundary</h2>
<p>The adapter manages the boundary between domain concepts and JVM
technology:</p>
<ul>
<li>Translates domain requests into JVM instrumentation calls</li>
<li>Handles JVM-specific exceptions and error conditions</li>
<li>Manages resource lifecycle for instrumentation operations</li>
<li>Provides performance monitoring and metrics collection</li>
</ul>
<h2 id="infrastructure-complexity-management">Infrastructure Complexity
Management</h2>
<p>The adapter encapsulates complex infrastructure concerns:</p>
<ul>
<li>Thread-safe access to JVM instrumentation capabilities</li>
<li>Validation of JVM limitations and compatibility constraints</li>
<li>Error handling and recovery for instrumentation failures</li>
<li>Performance optimization for bytecode manipulation operations</li>
</ul>
<h1 id="class-structure-and-responsibilities">Class Structure and
Responsibilities</h1>
<h2 id="core-attributes">Core Attributes</h2>
<div class="sourceCode" id="cb1"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> The JVM instrumentation instance</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">Instrumentation</span> instrumentation<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Counter for successful redefinitions</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">AtomicLong</span> redefinitionCount<span class="op">;</span></span></code></pre></div>
<h2 id="constructor-and-validation">Constructor and Validation</h2>
<div class="sourceCode" id="cb2"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates a new InstrumentationAdapter instance</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">InstrumentationAdapter</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Instrumentation</span> instrumentation<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>instrumentation <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span><span class="op">(</span><span class="st">&quot;Instrumentation cannot be null&quot;</span><span class="op">);</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">instrumentation</span> <span class="op">=</span> instrumentation<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">redefinitionCount</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">AtomicLong</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="interface-implementation-pattern">Interface Implementation
Pattern</h2>
<p>The adapter follows a strict implementation pattern:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Implementation characteristics:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Immutable state with final fields</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Comprehensive parameter validation</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Thread-safe operation counting</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Fail-fast error handling</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - Resource cleanup on failures</span></span></code></pre></div>
<h1 id="class-redefinition-implementation">Class Redefinition
Implementation</h1>
<h2 id="core-redefinition-method">Core Redefinition Method</h2>
<div class="sourceCode" id="cb4"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Redefines a class with new bytecode</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">redefineClass</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Class</span><span class="op">&lt;?&gt;</span> clazz<span class="op">,</span> <span class="dt">final</span> <span class="dt">byte</span><span class="op">[]</span> newBytecode<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>clazz <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span><span class="op">(</span><span class="st">&quot;Class cannot be null&quot;</span><span class="op">);</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>newBytecode <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> newBytecode<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span><span class="op">(</span><span class="st">&quot;Bytecode cannot be null or empty&quot;</span><span class="op">);</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>instrumentation<span class="op">.</span><span class="fu">isRedefineClassesSupported</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">UnsupportedOperationException</span><span class="op">(</span><span class="st">&quot;Class redefinition is not supported by this JVM&quot;</span><span class="op">);</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>instrumentation<span class="op">.</span><span class="fu">isModifiableClass</span><span class="op">(</span>clazz<span class="op">))</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">UnmodifiableClassException</span><span class="op">(</span><span class="st">&quot;Class is not modifiable: &quot;</span> <span class="op">+</span> clazz<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">ClassDefinition</span> definition <span class="op">=</span> <span class="kw">new</span> <span class="bu">ClassDefinition</span><span class="op">(</span>clazz<span class="op">,</span> newBytecode<span class="op">);</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        instrumentation<span class="op">.</span><span class="fu">redefineClasses</span><span class="op">(</span>definition<span class="op">);</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        redefinitionCount<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="dt">final</span> <span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Exception</span><span class="op">(</span><span class="st">&quot;Failed to redefine class &quot;</span> <span class="op">+</span> clazz<span class="op">.</span><span class="fu">getName</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">(),</span> e<span class="op">);</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="redefinition-safety-protocols">Redefinition Safety
Protocols</h2>
<p>The implementation enforces multiple safety layers:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Safety validation sequence:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Null parameter validation</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Bytecode content verification</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. JVM capability verification</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. Class modifiability validation</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// 5. Atomic redefinition execution</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 6. Success counter update</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">// 7. Comprehensive error handling</span></span></code></pre></div>
<h2 id="error-handling-strategy">Error Handling Strategy</h2>
<p>The adapter implements sophisticated error handling:</p>
<ul>
<li>Parameter validation with descriptive error messages</li>
<li>JVM capability checking before operation attempts</li>
<li>Class-specific modifiability verification</li>
<li>Atomic operation execution with rollback capability</li>
<li>Detailed exception chaining for debugging</li>
</ul>
<h1 id="capability-discovery-operations">Capability Discovery
Operations</h1>
<h2 id="jvm-feature-detection">JVM Feature Detection</h2>
<div class="sourceCode" id="cb6"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Checks if class redefinition is supported</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isRedefineClassesSupported</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation<span class="op">.</span><span class="fu">isRedefineClassesSupported</span><span class="op">();</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Checks if retransformation is supported</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isRetransformClassesSupported</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation<span class="op">.</span><span class="fu">isRetransformClassesSupported</span><span class="op">();</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Checks if instrumentation is available</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isInstrumentationAvailable</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation <span class="op">!=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="runtime-capability-assessment">Runtime Capability
Assessment</h2>
<p>The adapter provides dynamic capability assessment:</p>
<ul>
<li>Real-time JVM feature detection</li>
<li>Per-class modifiability verification</li>
<li>Instrumentation availability validation</li>
<li>Performance characteristic reporting</li>
</ul>
<h2 id="cross-platform-compatibility">Cross-Platform Compatibility</h2>
<p>Capability detection handles JVM implementation variations:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// JVM compatibility considerations:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - HotSpot JVM: Full instrumentation support</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - OpenJ9 JVM: Alternative instrumentation features  </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - GraalVM: Limited instrumentation in native mode</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Android Runtime: Specialized instrumentation APIs</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - Custom JVMs: Vendor-specific capabilities</span></span></code></pre></div>
<h1 id="runtime-introspection-implementation">Runtime Introspection
Implementation</h1>
<h2 id="class-loading-analysis">Class Loading Analysis</h2>
<div class="sourceCode" id="cb8"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Gets all loaded classes</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">Class</span><span class="op">&lt;?&gt;[]</span> <span class="fu">getAllLoadedClasses</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation<span class="op">.</span><span class="fu">getAllLoadedClasses</span><span class="op">();</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Returns the number of loaded classes</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">int</span> <span class="fu">getLoadedClassCount</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation<span class="op">.</span><span class="fu">getAllLoadedClasses</span><span class="op">().</span><span class="fu">length</span><span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="memory-analysis-operations">Memory Analysis Operations</h2>
<div class="sourceCode" id="cb9"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Returns the object size for the given object</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">long</span> <span class="fu">getObjectSize</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Object</span> objectToSize<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>objectToSize <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation<span class="op">.</span><span class="fu">getObjectSize</span><span class="op">(</span>objectToSize<span class="op">);</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="performance-monitoring-integration">Performance Monitoring
Integration</h2>
<p>The adapter provides comprehensive performance monitoring:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance metrics collected:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Redefinition operation count</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Class loading statistics</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Memory usage analysis</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Operation timing data</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - Error rate tracking</span></span></code></pre></div>
<h1 id="advanced-instrumentation-operations">Advanced Instrumentation
Operations</h1>
<h2 id="class-transformation-support">Class Transformation Support</h2>
<div class="sourceCode" id="cb11"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Retransforms the given classes</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">retransformClasses</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Class</span><span class="op">&lt;?&gt;</span><span class="kw">...</span> classes<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>instrumentation<span class="op">.</span><span class="fu">isRetransformClassesSupported</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">UnsupportedOperationException</span><span class="op">(</span><span class="st">&quot;Class retransformation is not supported by this JVM&quot;</span><span class="op">);</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        instrumentation<span class="op">.</span><span class="fu">retransformClasses</span><span class="op">(</span>classes<span class="op">);</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="dt">final</span> <span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Exception</span><span class="op">(</span><span class="st">&quot;Failed to retransform classes: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">(),</span> e<span class="op">);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="classfiletransformer-management">ClassFileTransformer
Management</h2>
<div class="sourceCode" id="cb12"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Adds a transformer to the instrumentation</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">addTransformer</span><span class="op">(</span><span class="dt">final</span> java<span class="op">.</span><span class="fu">lang</span><span class="op">.</span><span class="fu">instrument</span><span class="op">.</span><span class="fu">ClassFileTransformer</span> transformer<span class="op">,</span> <span class="dt">final</span> <span class="dt">boolean</span> canRetransform<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    instrumentation<span class="op">.</span><span class="fu">addTransformer</span><span class="op">(</span>transformer<span class="op">,</span> canRetransform<span class="op">);</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Removes a transformer from the instrumentation</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">removeTransformer</span><span class="op">(</span><span class="dt">final</span> java<span class="op">.</span><span class="fu">lang</span><span class="op">.</span><span class="fu">instrument</span><span class="op">.</span><span class="fu">ClassFileTransformer</span> transformer<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instrumentation<span class="op">.</span><span class="fu">removeTransformer</span><span class="op">(</span>transformer<span class="op">);</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="advanced-operations-strategy">Advanced Operations Strategy</h2>
<p>The adapter supports sophisticated instrumentation patterns:</p>
<ul>
<li>Batch class redefinition for related classes</li>
<li>Transformer pipeline management for complex modifications</li>
<li>Conditional transformation based on runtime state</li>
<li>Performance-optimized retransformation operations</li>
</ul>
<h1 id="thread-safety-and-concurrency">Thread Safety and
Concurrency</h1>
<h2 id="thread-safe-design">Thread-Safe Design</h2>
<p>The adapter ensures thread-safe operation across all methods:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Thread safety mechanisms:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Immutable state with final fields</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - AtomicLong for concurrent counter updates</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - JVM instrumentation API thread safety guarantees</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - No shared mutable state across operations</span></span></code></pre></div>
<h2 id="concurrent-operation-support">Concurrent Operation Support</h2>
<p>Multiple threads can safely use the adapter simultaneously:</p>
<ul>
<li>Thread-safe redefinition count tracking</li>
<li>Concurrent class introspection operations</li>
<li>Parallel capability detection calls</li>
<li>Synchronized access to JVM instrumentation</li>
</ul>
<h2 id="performance-under-concurrency">Performance Under
Concurrency</h2>
<p>The implementation optimizes for concurrent access:</p>
<ul>
<li>Lock-free counter increments using AtomicLong</li>
<li>Read-only operations require no synchronization</li>
<li>JVM instrumentation handles internal synchronization</li>
<li>Minimal contention points in adapter logic</li>
</ul>
<h1 id="error-handling-and-recovery">Error Handling and Recovery</h1>
<h2 id="comprehensive-exception-management">Comprehensive Exception
Management</h2>
<p>The adapter handles all categories of instrumentation errors:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Exception handling categories:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - IllegalArgumentException: Invalid parameters</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - UnsupportedOperationException: JVM limitations</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - UnmodifiableClassException: Class restrictions</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - RuntimeException: Instrumentation failures</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - OutOfMemoryError: Resource exhaustion</span></span></code></pre></div>
<h2 id="error-recovery-strategies">Error Recovery Strategies</h2>
<p>The adapter implements multiple recovery strategies:</p>
<ul>
<li>Parameter validation prevents invalid operations</li>
<li>Capability checking avoids unsupported operations</li>
<li>Atomic operations ensure consistent state</li>
<li>Detailed error reporting aids debugging</li>
</ul>
<h2 id="instrumentation-failure-handling">Instrumentation Failure
Handling</h2>
<p>Specialized handling for instrumentation-specific failures:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Failure scenarios handled:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Class redefinition limitations (method signature changes)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Security manager restrictions</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Module system access violations (Java 9+)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Memory limitations during redefinition</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - Concurrent modification conflicts</span></span></code></pre></div>
<h1 id="performance-optimization">Performance Optimization</h1>
<h2 id="operation-performance">Operation Performance</h2>
<p>The adapter optimizes instrumentation operation performance:</p>
<ul>
<li>Minimal object allocation during redefinition</li>
<li>Efficient parameter validation with early returns</li>
<li>Atomic counter updates without locks</li>
<li>Direct delegation to JVM instrumentation</li>
</ul>
<h2 id="memory-management">Memory Management</h2>
<p>Careful memory management throughout operations:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Memory optimization strategies:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Reuse of ClassDefinition objects where possible</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Immediate release of temporary bytecode references</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Efficient array operations for class listings</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - No caching of volatile JVM state</span></span></code></pre></div>
<h2 id="scalability-considerations">Scalability Considerations</h2>
<p>The adapter scales effectively with application size:</p>
<ul>
<li>O(1) operation complexity for individual class redefinition</li>
<li>Efficient batch operations for multiple classes</li>
<li>Minimal adapter overhead on JVM instrumentation</li>
<li>Memory-efficient handling of large class sets</li>
</ul>
<h1 id="integration-with-bytehot-architecture">Integration with ByteHot
Architecture</h1>
<h2 id="port-interface-compliance">Port Interface Compliance</h2>
<div class="sourceCode" id="cb17"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/infrastructure/instrumentation/InstrumentationAdapter.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Returns the port interface this adapter implements</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Override</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">Class</span><span class="op">&lt;</span>InstrumentationPort<span class="op">&gt;</span> <span class="fu">adapts</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> InstrumentationPort<span class="op">.</span><span class="fu">class</span><span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="adapter-pattern-implementation">Adapter Pattern
Implementation</h2>
<p>The adapter follows strict hexagonal architecture principles:</p>
<ul>
<li>Clean separation between domain and infrastructure concerns</li>
<li>No domain logic in infrastructure implementation</li>
<li>Complete delegation to JVM instrumentation APIs</li>
<li>Technology-specific error handling and translation</li>
</ul>
<h2 id="dependency-injection-support">Dependency Injection Support</h2>
<p>The adapter integrates seamlessly with ByteHot's dependency
injection:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Injection characteristics:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Constructor-based dependency injection</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Immutable state after construction</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Interface-based dependency resolution</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - No circular dependencies</span></span></code></pre></div>
<h1 id="testing-and-mock-support">Testing and Mock Support</h1>
<h2 id="testability-design">Testability Design</h2>
<p>The adapter enables comprehensive testing strategies:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Testing support features:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Constructor injection enables mock instrumentation</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - All methods are unit testable</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - State inspection through counter methods</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Exception simulation through mock implementations</span></span></code></pre></div>
<h2 id="mock-implementation-strategy">Mock Implementation Strategy</h2>
<p>Testing uses mock Instrumentation implementations:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Mock testing approach:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Mockito-based Instrumentation mocks</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Controlled capability simulation</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Exception scenario testing</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Performance characteristic simulation</span></span></code></pre></div>
<h2 id="integration-testing-support">Integration Testing Support</h2>
<p>The adapter supports comprehensive integration testing:</p>
<ul>
<li>Real JVM instrumentation testing on test classes</li>
<li>Performance testing under load</li>
<li>Concurrency testing with multiple threads</li>
<li>Error recovery testing with failure injection</li>
</ul>
<h1 id="security-considerations">Security Considerations</h1>
<h2 id="permission-management">Permission Management</h2>
<p>Instrumentation operations require careful permission management:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Security requirements:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Agent attachment permissions</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Class modification privileges</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Security manager compliance</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Module system integration (Java 9+)</span></span></code></pre></div>
<h2 id="validation-and-safety">Validation and Safety</h2>
<p>The adapter enforces security through validation:</p>
<ul>
<li>Parameter sanitization prevents malicious input</li>
<li>Capability verification prevents unauthorized operations</li>
<li>Class modifiability checks enforce JVM security policies</li>
<li>Exception handling prevents information leakage</li>
</ul>
<h2 id="audit-trail-integration">Audit Trail Integration</h2>
<p>All operations contribute to comprehensive audit trails:</p>
<ul>
<li>Operation success/failure logging</li>
<li>Performance metrics collection</li>
<li>Security event recording</li>
<li>Debugging information capture</li>
</ul>
<h1 id="jvm-version-compatibility">JVM Version Compatibility</h1>
<h2 id="cross-version-support">Cross-Version Support</h2>
<p>The adapter maintains compatibility across JVM versions:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// JVM version compatibility:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Java 8+: Basic instrumentation support</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Java 11+: Enhanced instrumentation features</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Java 17+: Improved security and performance</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Java 21+: Latest instrumentation capabilities</span></span></code></pre></div>
<h2 id="feature-detection-strategy">Feature Detection Strategy</h2>
<p>Dynamic feature detection handles version differences:</p>
<ul>
<li>Runtime capability assessment</li>
<li>Graceful degradation for missing features</li>
<li>Alternative implementation selection</li>
<li>Performance optimization based on available features</li>
</ul>
<h2 id="platform-specific-adaptations">Platform-Specific
Adaptations</h2>
<p>The adapter handles platform-specific variations:</p>
<ul>
<li>Different JVM implementation behaviors</li>
<li>Operating system specific limitations</li>
<li>Container environment considerations</li>
<li>Cloud platform compatibility</li>
</ul>
<h1 id="future-evolution-and-extensibility">Future Evolution and
Extensibility</h1>
<h2 id="extension-points">Extension Points</h2>
<p>The adapter design supports future enhancements:</p>
<ul>
<li>Additional instrumentation operations</li>
<li>Enhanced performance monitoring</li>
<li>Advanced transformation capabilities</li>
<li>Integration with external tools</li>
</ul>
<h2 id="backward-compatibility-strategy">Backward Compatibility
Strategy</h2>
<p>Evolution maintains backward compatibility:</p>
<ul>
<li>Interface stability through versioning</li>
<li>Graceful feature degradation</li>
<li>Migration path for deprecated features</li>
<li>Documentation for breaking changes</li>
</ul>
<h2 id="technology-integration-roadmap">Technology Integration
Roadmap</h2>
<p>Planned integration with emerging technologies:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Future integration targets:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Project Loom: Virtual thread compatibility</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Project Valhalla: Value type instrumentation</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - GraalVM Native Image: Native instrumentation support</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Project Panama: Foreign function integration</span></span></code></pre></div>
<h1 id="related-documentation">Related Documentation</h1>
<ul>
<li><span class="spurious-link"
target="ports/InstrumentationPort.org"><em>InstrumentationPort</em></span>:
Domain interface implemented by this adapter</li>
<li><span class="spurious-link"
target="ByteHot.org"><em>ByteHot</em></span>: Core domain aggregate
using instrumentation capabilities</li>
<li><span class="spurious-link"
target="events/ClassRedefinitionSucceeded.org"><em>ClassRedefinitionSucceeded</em></span>:
Success event from redefinition operations</li>
<li><span class="spurious-link"
target="events/ClassRedefinitionFailed.org"><em>ClassRedefinitionFailed</em></span>:
Failure event from redefinition operations</li>
<li><span class="spurious-link"
target="flows/hot-swap-complete-flow.org"><em>Hot-Swap Complete
Flow</em></span>: Complete process using this adapter</li>
</ul>
<h1 id="implementation-notes">Implementation Notes</h1>
<h2 id="design-patterns-applied">Design Patterns Applied</h2>
<p>The adapter leverages several key design patterns:</p>
<ul>
<li><strong><strong>Adapter Pattern</strong></strong>: Clean interface
between domain and infrastructure</li>
<li><strong><strong>Null Object Pattern</strong></strong>: Safe handling
of null parameters</li>
<li><strong><strong>Template Method</strong></strong>: Consistent error
handling across operations</li>
<li><strong><strong>Strategy Pattern</strong></strong>: Different
approaches based on JVM capabilities</li>
</ul>
<h2 id="code-quality-standards">Code Quality Standards</h2>
<p>The implementation maintains high code quality:</p>
<ul>
<li>Comprehensive parameter validation</li>
<li>Detailed exception messages for debugging</li>
<li>Consistent error handling patterns</li>
<li>Clear separation of concerns</li>
</ul>
<p>The InstrumentationAdapter provides ByteHot's critical infrastructure
implementation for JVM instrumentation operations while maintaining
architectural purity and enabling safe, performant, and reliable class
redefinition across diverse JVM environments and versions.</p>
</main>
<div class="footer">
    ByteHot - Revolutionary JVM Hot-Swapping | 
    <a href="https://github.com/rydnr/bytehot">GitHub</a> | 
    <a href="https://rydnr.github.io/bytehot/docs/">Documentation</a> | 
    <a href="https://rydnr.github.io/bytehot/javadocs/">API Docs</a>
</div>
</body></html>
