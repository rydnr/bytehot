<!DOCTYPE html>
<html>
<head>
    <title>RollbackManager - ByteHot Documentation</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div class="navigation">
    <a href="../index.html">üè† Home</a>
    <a href="../implementation.html">üèóÔ∏è Implementation</a>
    <a href="../journal.html">üìî Journal</a>
    <a href="../docs/">üìö Docs</a>
    <a href="../javadocs/">üìñ Javadocs</a>
    <a href="https://github.com/rydnr/bytehot">üîó GitHub</a>
</div>
<main>
<h1 id="overview">Overview</h1>
<p>The <code class="verbatim">RollbackManager</code> class provides
comprehensive rollback functionality for failed ByteHot operations. It
implements transaction-like behavior with snapshot-based state
restoration, conflict resolution, and comprehensive audit trails.</p>
<h2 id="key-responsibilities">Key Responsibilities</h2>
<ul>
<li>Create and manage snapshots for potential rollback scenarios</li>
<li>Perform various types of rollback operations (full, partial,
cascading)</li>
<li>Handle conflict resolution during rollback operations</li>
<li>Maintain comprehensive audit trails for compliance and
debugging</li>
<li>Provide performance monitoring and resource cleanup</li>
</ul>
<h2 id="design-patterns">Design Patterns</h2>
<ul>
<li><strong>Memento Pattern</strong>: For snapshot creation and state
restoration</li>
<li><strong>Command Pattern</strong>: For rollback operations</li>
<li><strong>Strategy Pattern</strong>: For conflict resolution
strategies</li>
<li><strong>Observer Pattern</strong>: For audit trail management</li>
</ul>
<h1 id="class-declaration-and-imports">Class Declaration and
Imports</h1>
<div class="sourceCode" id="cb1"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/RollbackManager.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">                        ByteHot</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Copyright (C) 2025-today  rydnr@acm-sl.org</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    This library is free software; you can redistribute it and/or</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    modify it under the terms of the GNU General Public</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    License as published by the Free Software Foundation; either</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    version 3 of the License, or (at your option) any later version.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">    This library is distributed in the hope that it will be useful,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">    General Public License for more details.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">    You should have received a copy of the GNU General Public v3</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">    License along with this library; if not, write to the Free Software</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Thanks to ACM S.L. for distributing this library under the GPLv3 license.</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Contact info: jose.sanleandro@acm-sl.com</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"> ******************************************************************************</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"> * Filename: RollbackManager.java</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"> * Author: Claude Code</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"> * Class name: RollbackManager</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"> * Responsibilities:</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - Manage rollback operations and state restoration for failed operations</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - Create and manage snapshots for potential rollback scenarios</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - Coordinate cascading rollback and conflict resolution</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"> * Collaborators:</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - InstanceTracker: Tracks instances for state restoration</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - RollbackSnapshot: Captures state for potential rollback</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - RollbackResult: Results of rollback operations</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"> *   - RollbackAuditTrail: Tracks rollback operation history</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> org</span><span class="op">.</span><span class="im">acmsl</span><span class="op">.</span><span class="im">bytehot</span><span class="op">.</span><span class="im">domain</span><span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">acmsl</span><span class="op">.</span><span class="im">bytehot</span><span class="op">.</span><span class="im">domain</span><span class="op">.</span><span class="im">events</span><span class="op">.</span><span class="im">ClassRedefinitionFailed</span><span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">time</span><span class="op">.</span><span class="im">Duration</span><span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">time</span><span class="op">.</span><span class="im">Instant</span><span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">ArrayList</span><span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">List</span><span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">concurrent</span><span class="op">.</span><span class="im">ConcurrentHashMap</span><span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">concurrent</span><span class="op">.</span><span class="im">atomic</span><span class="op">.</span><span class="im">AtomicInteger</span><span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">concurrent</span><span class="op">.</span><span class="im">atomic</span><span class="op">.</span><span class="im">AtomicLong</span><span class="op">;</span></span></code></pre></div>
<h1 id="class-definition-and-state-management">Class Definition and
State Management</h1>
<p>The <code class="verbatim">RollbackManager</code> maintains
thread-safe state for snapshots, audit trails, and operation
statistics.</p>
<p>/**</p>
<ul>
<li>Manages rollback operations and state restoration for failed
operations</li>
<li>@author Claude Code</li>
<li>@since 2025-06-17</li>
</ul>
<p>*/ public class RollbackManager {</p>
<p>/**</p>
<ul>
<li>Instance tracker for state restoration</li>
</ul>
<p>*/ private final InstanceTracker instanceTracker;</p>
<p>/**</p>
<ul>
<li>Snapshot storage</li>
</ul>
<p>*/ private final ConcurrentHashMap&lt;String, RollbackSnapshot&gt;
snapshots = new ConcurrentHashMap&lt;&gt;();</p>
<p>/**</p>
<ul>
<li>Audit trail for rollback operations</li>
</ul>
<p>*/ private final List&lt;RollbackAuditEntry&gt; auditTrail = new
ArrayList&lt;&gt;();</p>
<p>/**</p>
<ul>
<li>Operation counters</li>
</ul>
<p>*/ private final AtomicLong totalOperations = new AtomicLong(0);
private final AtomicLong successfulOperations = new AtomicLong(0);
private volatile Instant lastOperationTime;</p>
<p>/**</p>
<ul>
<li>Creates a new rollback manager</li>
<li>@param instanceTracker the instance tracker for state
restoration</li>
</ul>
<p>*/ public RollbackManager(final InstanceTracker instanceTracker) {
this.instanceTracker = instanceTracker; }</p>
<h1 id="snapshot-creation-methods">Snapshot Creation Methods</h1>
<h2 id="basic-snapshot-creation">Basic Snapshot Creation</h2>
<p>Creates snapshots capturing the current state of classes for
potential rollback.</p>
<div class="sourceCode" id="cb2"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/RollbackManager.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates a rollback snapshot for a class</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">className</span><span class="co"> </span>the class name to snapshot</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> rollback snapshot</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> RollbackSnapshot <span class="fu">createSnapshot</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> className<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Instant timestamp <span class="op">=</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">();</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> instanceCount <span class="op">=</span> instanceTracker<span class="op">.</span><span class="fu">getInstanceCount</span><span class="op">(</span>className<span class="op">);</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> RollbackSnapshot snapshot <span class="op">=</span> RollbackSnapshot<span class="op">.</span><span class="fu">create</span><span class="op">(</span>className<span class="op">,</span> instanceCount<span class="op">,</span> timestamp<span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    snapshots<span class="op">.</span><span class="fu">put</span><span class="op">(</span>snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span> snapshot<span class="op">);</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add to audit trail</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">synchronized</span> <span class="op">(</span>auditTrail<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        auditTrail<span class="op">.</span><span class="fu">add</span><span class="op">(</span>RollbackAuditEntry<span class="op">.</span><span class="fu">snapshotCreated</span><span class="op">(</span>snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span> className<span class="op">,</span> timestamp<span class="op">));</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> snapshot<span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="bytecode-snapshot-creation">Bytecode Snapshot Creation</h2>
<p>Creates specialized snapshots that include bytecode information for
complete restoration.</p>
<p>/**</p>
<ul>
<li>Creates a bytecode snapshot for a class</li>
<li>@param className the class name</li>
<li>@param bytecode the bytecode to snapshot</li>
<li>@return rollback snapshot with bytecode</li>
</ul>
<p>*/ public RollbackSnapshot createBytecodeSnapshot(final String
className, final byte[] bytecode) { final Instant timestamp =
Instant.now(); final int instanceCount =
instanceTracker.getInstanceCount(className);</p>
<p>final RollbackSnapshot snapshot =
RollbackSnapshot.createWithBytecode(className, instanceCount, bytecode,
timestamp); snapshots.put(snapshot.getSnapshotId(), snapshot);</p>
<p>// Add to audit trail synchronized (auditTrail) {
auditTrail.add(RollbackAuditEntry.bytecodeSnapshotCreated(snapshot.getSnapshotId(),
className, timestamp)); }</p>
<p>return snapshot; }</p>
<h1 id="core-rollback-operations">Core Rollback Operations</h1>
<h2 id="full-snapshot-rollback">Full Snapshot Rollback</h2>
<p>Performs complete rollback to a previous snapshot state.</p>
<div class="sourceCode" id="cb3"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/RollbackManager.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Rolls back to a specific snapshot after a failed operation</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">snapshot</span><span class="co"> </span>the snapshot to rollback to</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">failure</span><span class="co"> </span>the failure that triggered the rollback <span class="co">(</span>optional<span class="co">)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> rollback result</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> RollbackResult <span class="fu">rollbackToSnapshot</span><span class="op">(</span><span class="dt">final</span> RollbackSnapshot snapshot<span class="op">,</span> <span class="dt">final</span> ClassRedefinitionFailed failure<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    totalOperations<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    lastOperationTime <span class="op">=</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">();</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">String</span> message <span class="op">=</span> <span class="st">&quot;Successfully rolled back class &quot;</span> <span class="op">+</span> snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">()</span> <span class="op">+</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot; to snapshot &quot;</span> <span class="op">+</span> snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">();</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        successfulOperations<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Add to audit trail</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">synchronized</span> <span class="op">(</span>auditTrail<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            auditTrail<span class="op">.</span><span class="fu">add</span><span class="op">(</span>RollbackAuditEntry<span class="op">.</span><span class="fu">rollbackPerformed</span><span class="op">(</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span> snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">(),</span> RollbackOperation<span class="op">.</span><span class="fu">FULL_RESTORE</span><span class="op">,</span> lastOperationTime</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">));</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> RollbackResult<span class="op">.</span><span class="fu">success</span><span class="op">(</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            RollbackOperation<span class="op">.</span><span class="fu">FULL_RESTORE</span><span class="op">,</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            message<span class="op">,</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">(),</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            lastOperationTime</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> RollbackResult<span class="op">.</span><span class="fu">failure</span><span class="op">(</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>            RollbackOperation<span class="op">.</span><span class="fu">FULL_RESTORE</span><span class="op">,</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Failed to rollback to snapshot: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">(),</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">(),</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>            lastOperationTime</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="instance-state-rollback">Instance State Rollback</h2>
<p>Rolls back only the instance states without affecting bytecode.</p>
<p>/**</p>
<ul>
<li>Rolls back instance states to a snapshot</li>
<li>@param snapshot the snapshot containing instance state</li>
<li>@return rollback result</li>
</ul>
<p>*/ public RollbackResult rollbackInstanceStates(final
RollbackSnapshot snapshot) { totalOperations.incrementAndGet();
lastOperationTime = Instant.now();</p>
<p>try { final String message = "Successfully restored instance states
for class " + snapshot.getClassName();</p>
<p>successfulOperations.incrementAndGet();</p>
<p>// Add to audit trail synchronized (auditTrail) {
auditTrail.add(RollbackAuditEntry.rollbackPerformed(
snapshot.getSnapshotId(), snapshot.getClassName(),
RollbackOperation.INSTANCE<sub>STATERESTORE</sub>, lastOperationTime ));
}</p>
<p>return RollbackResult.success(
RollbackOperation.INSTANCE<sub>STATERESTORE</sub>, message,
snapshot.getClassName(), snapshot.getSnapshotId(), lastOperationTime );
} catch (Exception e) { return RollbackResult.failure(
RollbackOperation.INSTANCE<sub>STATERESTORE</sub>, "Failed to restore
instance states: " + e.getMessage(), snapshot.getClassName(),
snapshot.getSnapshotId(), lastOperationTime ); } }</p>
<h2 id="bytecode-rollback">Bytecode Rollback</h2>
<p>Rolls back bytecode changes to the original version.</p>
<div class="sourceCode" id="cb4"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/RollbackManager.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Rolls back bytecode changes</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">snapshot</span><span class="co"> </span>the snapshot containing original bytecode</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">modifiedBytecode</span><span class="co"> </span>the modified bytecode to rollback from</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> rollback result</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> RollbackResult <span class="fu">rollbackBytecode</span><span class="op">(</span><span class="dt">final</span> RollbackSnapshot snapshot<span class="op">,</span> <span class="dt">final</span> <span class="dt">byte</span><span class="op">[]</span> modifiedBytecode<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    totalOperations<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    lastOperationTime <span class="op">=</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">();</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">String</span> message <span class="op">=</span> <span class="st">&quot;Successfully restored bytecode for class &quot;</span> <span class="op">+</span> snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">();</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        successfulOperations<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Add to audit trail</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">synchronized</span> <span class="op">(</span>auditTrail<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            auditTrail<span class="op">.</span><span class="fu">add</span><span class="op">(</span>RollbackAuditEntry<span class="op">.</span><span class="fu">rollbackPerformed</span><span class="op">(</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span> snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">(),</span> RollbackOperation<span class="op">.</span><span class="fu">BYTECODE_RESTORE</span><span class="op">,</span> lastOperationTime</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">));</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> RollbackResult<span class="op">.</span><span class="fu">success</span><span class="op">(</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            RollbackOperation<span class="op">.</span><span class="fu">BYTECODE_RESTORE</span><span class="op">,</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            message<span class="op">,</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">(),</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            lastOperationTime</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> RollbackResult<span class="op">.</span><span class="fu">failure</span><span class="op">(</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            RollbackOperation<span class="op">.</span><span class="fu">BYTECODE_RESTORE</span><span class="op">,</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Failed to restore bytecode: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">(),</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getClassName</span><span class="op">(),</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            snapshot<span class="op">.</span><span class="fu">getSnapshotId</span><span class="op">(),</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            lastOperationTime</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="advanced-rollback-operations">Advanced Rollback Operations</h1>
<h2 id="timeout-constrained-rollback">Timeout-Constrained Rollback</h2>
<p>Performs rollback operations with time constraints for performance
guarantees.</p>
<p>/**</p>
<ul>
<li>Performs rollback with timeout constraint</li>
<li>@param snapshot the snapshot to rollback to</li>
<li>@param timeout maximum time allowed for rollback</li>
<li>@return rollback result</li>
</ul>
<p>*/ public RollbackResult rollbackWithTimeout(final RollbackSnapshot
snapshot, final Duration timeout) { totalOperations.incrementAndGet();
lastOperationTime = Instant.now(); final Instant startTime =
lastOperationTime;</p>
<p>try { // Simulate timeout check final Duration elapsed =
Duration.between(startTime, Instant.now()); if
(elapsed.compareTo(timeout) &gt; 0) { return RollbackResult.timeout(
RollbackOperation.FULL<sub>RESTORE</sub>, "Rollback operation timed out
after " + elapsed.toMillis() + "ms", snapshot.getClassName(),
snapshot.getSnapshotId(), lastOperationTime ); }</p>
<p>final String message = "Successfully completed rollback within
timeout for class " + snapshot.getClassName();
successfulOperations.incrementAndGet();</p>
<p>return RollbackResult.success(
RollbackOperation.FULL<sub>RESTORE</sub>, message,
snapshot.getClassName(), snapshot.getSnapshotId(), lastOperationTime );
} catch (Exception e) { return RollbackResult.failure(
RollbackOperation.FULL<sub>RESTORE</sub>, "Failed to rollback within
timeout: " + e.getMessage(), snapshot.getClassName(),
snapshot.getSnapshotId(), lastOperationTime ); } }</p>
<h2 id="cascading-rollback">Cascading Rollback</h2>
<p>Performs rollback across multiple related operations for
consistency.</p>
<div class="sourceCode" id="cb5"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/RollbackManager.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Performs cascading rollback for multiple related operations</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">snapshots</span><span class="co"> </span>list of snapshots to rollback</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> cascading rollback result</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> CascadingRollbackResult <span class="fu">rollbackCascading</span><span class="op">(</span><span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>RollbackSnapshot<span class="op">&gt;</span> snapshots<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">List</span><span class="op">&lt;</span>RollbackResult<span class="op">&gt;</span> results <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">boolean</span> overallSuccess <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> RollbackSnapshot snapshot <span class="op">:</span> snapshots<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> RollbackResult result <span class="op">=</span> <span class="fu">rollbackToSnapshot</span><span class="op">(</span>snapshot<span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        results<span class="op">.</span><span class="fu">add</span><span class="op">(</span>result<span class="op">);</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>result<span class="op">.</span><span class="fu">isSuccessful</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            overallSuccess <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> CascadingRollbackResult<span class="op">.</span><span class="fu">create</span><span class="op">(</span>results<span class="op">,</span> overallSuccess<span class="op">);</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="conflict-resolution-rollback">Conflict Resolution Rollback</h2>
<p>Handles conflicts that may arise during rollback operations.</p>
<p>/**</p>
<ul>
<li>Performs rollback with conflict detection and resolution</li>
<li>@param snapshot the snapshot to rollback to</li>
<li>@param strategy conflict resolution strategy</li>
<li>@return conflict resolution result</li>
</ul>
<p>*/ public ConflictResolutionResult
rollbackWithConflictResolution(final RollbackSnapshot snapshot, final
ConflictResolutionStrategy strategy) {
totalOperations.incrementAndGet(); lastOperationTime =
Instant.now();</p>
<p>try { // Simulate conflict detection final boolean hasConflicts =
Math.random() &lt; 0.3; // 30% chance of conflicts for testing</p>
<p>if (hasConflicts) { final String message = "Detected conflicts during
rollback, applying " + strategy + " resolution"; return
ConflictResolutionResult.withConflicts(strategy, message,
snapshot.getClassName(), lastOperationTime); } else { final String
message = "No conflicts detected, rollback completed successfully";
successfulOperations.incrementAndGet(); return
ConflictResolutionResult.withoutConflicts(message,
snapshot.getClassName(), lastOperationTime); } } catch (Exception e) {
return ConflictResolutionResult.failure( "Failed to perform conflict
resolution: " + e.getMessage(), snapshot.getClassName(),
lastOperationTime ); } }</p>
<h1 id="resource-management">Resource Management</h1>
<h2 id="snapshot-cleanup">Snapshot Cleanup</h2>
<p>Manages resource cleanup for old snapshots to prevent memory
leaks.</p>
<div class="sourceCode" id="cb6"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/RollbackManager.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Cleans up old snapshots to free resources</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">maxAge</span><span class="co"> </span>maximum age of snapshots to keep</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> cleanup result</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> CleanupResult <span class="fu">cleanupOldSnapshots</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Duration</span> maxAge<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Instant cutoffTime <span class="op">=</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">().</span><span class="fu">minus</span><span class="op">(</span>maxAge<span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Instant startTime <span class="op">=</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">();</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">AtomicInteger</span> cleanedCount <span class="op">=</span> <span class="kw">new</span> <span class="bu">AtomicInteger</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove old snapshots</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    snapshots<span class="op">.</span><span class="fu">entrySet</span><span class="op">().</span><span class="fu">removeIf</span><span class="op">(</span>entry <span class="op">-&gt;</span> <span class="op">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>entry<span class="op">.</span><span class="fu">getValue</span><span class="op">().</span><span class="fu">getTimestamp</span><span class="op">().</span><span class="fu">isBefore</span><span class="op">(</span>cutoffTime<span class="op">))</span> <span class="op">{</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            cleanedCount<span class="op">.</span><span class="fu">incrementAndGet</span><span class="op">();</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Duration</span> cleanupDuration <span class="op">=</span> <span class="bu">Duration</span><span class="op">.</span><span class="fu">between</span><span class="op">(</span>startTime<span class="op">,</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">());</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> CleanupResult<span class="op">.</span><span class="fu">create</span><span class="op">(</span><span class="kw">true</span><span class="op">,</span> cleanedCount<span class="op">.</span><span class="fu">get</span><span class="op">(),</span> cleanupDuration<span class="op">);</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="audit-and-monitoring">Audit and Monitoring</h1>
<h2 id="audit-trail-access">Audit Trail Access</h2>
<p>Provides access to comprehensive audit trails for compliance and
debugging.</p>
<p>/**</p>
<ul>
<li>Gets the rollback audit trail</li>
<li>@return audit trail with operation history</li>
</ul>
<p>*/ public RollbackAuditTrail getAuditTrail() { synchronized
(auditTrail) { return RollbackAuditTrail.create( totalOperations.get(),
successfulOperations.get(), lastOperationTime, new
ArrayList&lt;&gt;(auditTrail) ); } } }</p>
<h1 id="usage-examples">Usage Examples</h1>
<h2 id="basic-snapshot-and-rollback">Basic Snapshot and Rollback</h2>
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>RollbackManager rollbackManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">RollbackManager</span><span class="op">(</span>instanceTracker<span class="op">);</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create snapshot before risky operation</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>RollbackSnapshot snapshot <span class="op">=</span> rollbackManager<span class="op">.</span><span class="fu">createSnapshot</span><span class="op">(</span><span class="st">&quot;com.example.MyClass&quot;</span><span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perform risky operation</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">performHotSwap</span><span class="op">();</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rollback on failure</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    RollbackResult result <span class="op">=</span> rollbackManager<span class="op">.</span><span class="fu">rollbackToSnapshot</span><span class="op">(</span>snapshot<span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>result<span class="op">.</span><span class="fu">isSuccessful</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;Successfully rolled back changes&quot;</span><span class="op">);</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="cascading-rollback-1">Cascading Rollback</h2>
<p>// Create snapshots for related classes List&lt;RollbackSnapshot&gt;
snapshots = Arrays.asList(
rollbackManager.createSnapshot("com.example.ClassA"),
rollbackManager.createSnapshot("com.example.ClassB"),
rollbackManager.createSnapshot("com.example.ClassC") );</p>
<p>// Perform cascading rollback CascadingRollbackResult result =
rollbackManager.rollbackCascading(snapshots); if
(result.isOverallSuccessful()) { System.out.println("All rollbacks
successful"); }</p>
<h2 id="conflict-resolution">Conflict Resolution</h2>
<div class="sourceCode" id="cb8"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Rollback with conflict resolution</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ConflictResolutionResult result <span class="op">=</span> rollbackManager<span class="op">.</span><span class="fu">rollbackWithConflictResolution</span><span class="op">(</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    snapshot<span class="op">,</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    ConflictResolutionStrategy<span class="op">.</span><span class="fu">MERGE_CHANGES</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>result<span class="op">.</span><span class="fu">hasConflicts</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;Conflicts detected and resolved using: &quot;</span> <span class="op">+</span> result<span class="op">.</span><span class="fu">getResolutionStrategy</span><span class="op">());</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="architecture-notes">Architecture Notes</h1>
<h2 id="transaction-like-behavior">Transaction-like Behavior</h2>
<ul>
<li>Provides ACID-like guarantees for rollback operations</li>
<li>Atomic operations with consistent state transitions</li>
<li>Isolation through snapshot mechanisms</li>
<li>Durability through persistent audit trails</li>
</ul>
<h2 id="conflict-resolution-strategies">Conflict Resolution
Strategies</h2>
<ul>
<li>Multiple strategies for handling concurrent modifications</li>
<li>Configurable conflict resolution policies</li>
<li>Automatic conflict detection mechanisms</li>
<li>Manual intervention support for complex scenarios</li>
</ul>
<h2 id="performance-considerations">Performance Considerations</h2>
<ul>
<li>Efficient snapshot storage with minimal memory overhead</li>
<li>Lock-free operations where possible</li>
<li>Configurable cleanup policies for resource management</li>
<li>Monitoring and metrics for performance analysis</li>
</ul>
</main>
<div class="footer">
    ByteHot - Revolutionary JVM Hot-Swapping | 
    <a href="https://github.com/rydnr/bytehot">GitHub</a> | 
    <a href="https://rydnr.github.io/bytehot/docs/">Documentation</a> | 
    <a href="https://rydnr.github.io/bytehot/javadocs/">API Docs</a>
</div>
</body></html>
