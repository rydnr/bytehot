<!DOCTYPE html>
<html>
<head>
    <title>Ports - ByteHot Documentation</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div class="navigation">
    <a href="../index.html">üè† Home</a>
    <a href="../implementation.html">üèóÔ∏è Implementation</a>
    <a href="../journal.html">üìî Journal</a>
    <a href="../docs/">üìö Docs</a>
    <a href="../javadocs/">üìñ Javadocs</a>
    <a href="https://github.com/rydnr/bytehot">üîó GitHub</a>
</div>
<main>
<h1 id="overview">Overview</h1>
<p>The <code>Ports</code> class represents the critical infrastructure
that enables Hexagonal Architecture's dependency inversion principle
within ByteHot's domain layer. It serves as the sole mechanism through
which domain objects access external capabilities while maintaining
complete independence from infrastructure concerns.</p>
<h1 id="architectural-significance">Architectural Significance</h1>
<h2 id="hexagonal-architecture-implementation">Hexagonal Architecture
Implementation</h2>
<p>The Ports class implements the core principle of Hexagonal
Architecture by providing a clean separation between domain logic and
infrastructure:</p>
<pre><code>Domain Layer        Application Layer      Infrastructure Layer
    ‚Üì                      ‚Üì                      ‚Üì
[Domain Object] ‚Üí [Port Interface] ‚Üê [Adapter Implementation]
                      ‚Üë
               [Ports.resolve()]
</code></pre>
<h2 id="dependency-inversion-principle">Dependency Inversion
Principle</h2>
<p>Through the Ports infrastructure, domain objects depend only on
abstractions (Port interfaces), never on concrete implementations:</p>
<ul>
<li><strong>High-level modules</strong> (Domain) do not depend on
low-level modules (Infrastructure)</li>
<li><strong>Both depend on abstractions</strong> (Port interfaces)</li>
<li><strong>Abstractions do not depend on details</strong>
(Infrastructure implementations)</li>
</ul>
<h1 id="class-architecture">Class Architecture</h1>
<h2 id="singleton-pattern-with-thread-safety">Singleton Pattern with
Thread Safety</h2>
<p>The Ports class implements the Singleton pattern with double-checked
locking for thread-safe lazy initialization:</p>
<div class="sourceCode" id="cb2"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/Ports.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> The singleton instance</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="kw">volatile</span> Ports instance<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Returns the singleton instance</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span> the Ports instance</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> Ports <span class="fu">getInstance</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>instance <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">synchronized</span> <span class="op">(</span>Ports<span class="op">.</span><span class="fu">class</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>instance <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                instance <span class="op">=</span> <span class="kw">new</span> <span class="fu">Ports</span><span class="op">();</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> instance<span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Design Rationale</strong>: Global singleton ensures
consistent port resolution across the entire domain layer while
maintaining thread safety in concurrent environments.</p>
<h2 id="inheritance-from-cachingportresolver">Inheritance from
CachingPortResolver</h2>
<p>Extends the java-commons <code>CachingPortResolver</code> to leverage
caching capabilities:</p>
<div class="sourceCode" id="cb3"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/Ports.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Ports</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">extends</span> CachingPortResolver <span class="op">{</span></span></code></pre></div>
<p><strong>Benefits</strong>:</p>
<ul>
<li>Performance optimization through adapter caching</li>
<li>Consistent resolution behavior across multiple calls</li>
<li>Memory efficiency by reusing adapter instances</li>
</ul>
<h1 id="core-resolution-mechanism">Core Resolution Mechanism</h1>
<h2 id="static-port-resolution">Static Port Resolution</h2>
<p>The primary interface for domain objects to access infrastructure
capabilities:</p>
<div class="sourceCode" id="cb4"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/Ports.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Resolves a port implementation</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">port</span><span class="co"> </span>the port interface class</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> the port implementation</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@throws</span><span class="co"> </span><span class="an">RuntimeException</span><span class="co"> </span>if no implementation is found</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">@SuppressWarnings</span><span class="op">(</span><span class="st">&quot;unchecked&quot;</span><span class="op">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span>P <span class="kw">extends</span> <span class="bu">Port</span><span class="op">&gt;</span> P <span class="fu">resolve</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Class</span><span class="op">&lt;</span>P<span class="op">&gt;</span> port<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Ports instance <span class="op">=</span> <span class="fu">getInstance</span><span class="op">();</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> java<span class="op">.</span><span class="fu">util</span><span class="op">.</span><span class="fu">Optional</span><span class="op">&lt;</span>Adapter<span class="op">&lt;</span>P<span class="op">&gt;&gt;</span> adapter <span class="op">=</span> instance<span class="op">.</span><span class="fu">_resolve</span><span class="op">(</span>port<span class="op">);</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>adapter<span class="op">.</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;No implementation found for port: &quot;</span> <span class="op">+</span> port<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>P<span class="op">)</span> adapter<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="resolution-process">Resolution Process</h2>
<ol>
<li><strong>Instance Acquisition</strong>: Obtains singleton Ports
instance</li>
<li><strong>Adapter Lookup</strong>: Searches for registered adapter
using inherited <code>_resolve</code> method</li>
<li><strong>Validation</strong>: Ensures an implementation exists for
the requested port</li>
<li><strong>Type-Safe Return</strong>: Returns properly typed port
implementation</li>
<li><strong>Error Handling</strong>: Throws descriptive exception if no
adapter found</li>
</ol>
<h2 id="type-safety-and-generics">Type Safety and Generics</h2>
<p>The resolution mechanism maintains type safety through generic
parameters:</p>
<ul>
<li>Input: <code>Class&lt;P extends Port&gt;</code> ensures only valid
port interfaces</li>
<li>Output: <code>P</code> guarantees returned implementation matches
requested type</li>
<li>Casting: Safely casts adapter to port interface</li>
</ul>
<h1 id="injection-mechanism">Injection Mechanism</h1>
<h2 id="adapter-registration">Adapter Registration</h2>
<p>The application layer uses the injection mechanism to register
infrastructure adapters:</p>
<div class="sourceCode" id="cb5"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/Ports.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Do not call<span class="co">! </span>It<span class="co">&#39;</span>s used by the application layer<span class="co">.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">@SuppressWarnings</span><span class="op">(</span><span class="st">&quot;unchecked&quot;</span><span class="op">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="op">&lt;</span>P <span class="kw">extends</span> <span class="bu">Port</span><span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">inject</span><span class="op">(</span><span class="dt">final</span> <span class="bu">Class</span><span class="op">&lt;</span>P<span class="op">&gt;</span> port<span class="op">,</span> <span class="dt">final</span> Adapter<span class="op">&lt;</span>P<span class="op">&gt;</span> adapter<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="bu">Class</span><span class="op">&lt;?</span> <span class="kw">extends</span> <span class="bu">Port</span><span class="op">&gt;,</span> <span class="bu">List</span><span class="op">&lt;</span>Adapter<span class="op">&lt;?</span> <span class="kw">extends</span> <span class="bu">Port</span><span class="op">&gt;&gt;&gt;</span> implementations <span class="op">=</span> <span class="fu">getImplementations</span><span class="op">();</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>Adapter<span class="op">&lt;</span>P<span class="op">&gt;&gt;</span> adapters <span class="op">=</span> <span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>Adapter<span class="op">&lt;</span>P<span class="op">&gt;&gt;)</span> <span class="op">(</span><span class="bu">List</span><span class="op">&lt;?&gt;)</span> implementations<span class="op">.</span><span class="fu">get</span><span class="op">(</span>port<span class="op">);</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>adapters <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        adapters <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        implementations<span class="op">.</span><span class="fu">put</span><span class="op">(</span>port<span class="op">,</span> <span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>Adapter<span class="op">&lt;?</span> <span class="kw">extends</span> <span class="bu">Port</span><span class="op">&gt;&gt;)</span> <span class="op">(</span><span class="bu">List</span><span class="op">&lt;?&gt;)</span> adapters<span class="op">);</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>adapters<span class="op">.</span><span class="fu">contains</span><span class="op">(</span>adapter<span class="op">))</span> <span class="op">{</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        adapters<span class="op">.</span><span class="fu">add</span><span class="op">(</span>adapter<span class="op">);</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="injection-process">Injection Process</h2>
<ol>
<li><strong>Implementation Map Access</strong>: Retrieves the internal
adapter registry</li>
<li><strong>Adapter List Creation</strong>: Creates new list if first
adapter for this port</li>
<li><strong>Duplicate Prevention</strong>: Avoids registering the same
adapter multiple times</li>
<li><strong>Registration</strong>: Adds adapter to the port's
implementation list</li>
</ol>
<h2 id="access-control">Access Control</h2>
<p>The method documentation explicitly warns against direct usage: "Do
not call! It's used by the application layer."</p>
<p><strong>Design Intent</strong>: Restricts injection to the
application layer, maintaining clean architectural boundaries.</p>
<h1 id="usage-patterns-in-domain-layer">Usage Patterns in Domain
Layer</h1>
<h2 id="typical-domain-usage">Typical Domain Usage</h2>
<p>Domain objects access infrastructure through simple, clean port
resolution:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In a domain aggregate or service</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">performFileOperation</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> FileWatcherPort fileWatcher <span class="op">=</span> Ports<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span>FileWatcherPort<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    fileWatcher<span class="op">.</span><span class="fu">startWatching</span><span class="op">(</span><span class="st">&quot;/path/to/files&quot;</span><span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">// In an event handler</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">emitEvent</span><span class="op">(</span>DomainEvent event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> EventEmitterPort emitter <span class="op">=</span> Ports<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span>EventEmitterPort<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    emitter<span class="op">.</span><span class="fu">emit</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="error-handling-in-domain">Error Handling in Domain</h2>
<p>When ports cannot be resolved, the domain receives clear error
information:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> ConfigurationPort config <span class="op">=</span> Ports<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span>ConfigurationPort<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> config<span class="op">.</span><span class="fu">getWatchPaths</span><span class="op">();</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="bu">RuntimeException</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle missing infrastructure gracefully</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span><span class="fu">error</span><span class="op">(</span><span class="st">&quot;Configuration port not available: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">getMessage</span><span class="op">());</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">defaultPaths</span><span class="op">();</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="infrastructure-integration-points">Infrastructure Integration
Points</h1>
<h2 id="supported-port-types">Supported Port Types</h2>
<p>The Ports infrastructure supports all ByteHot port interfaces:</p>
<ul>
<li><strong>ConfigurationPort</strong>: System configuration access</li>
<li><strong>EventEmitterPort</strong>: Domain event publication</li>
<li><strong>FileWatcherPort</strong>: File system monitoring</li>
<li><strong>InstrumentationPort</strong>: JVM instrumentation
capabilities</li>
<li><strong>FlowDetectionPort</strong>: Flow analysis and detection</li>
<li><strong>EventStorePort</strong>: Event persistence for event
sourcing</li>
</ul>
<h2 id="adapter-registration-flow">Adapter Registration Flow</h2>
<p>The typical registration flow during application initialization:</p>
<pre><code>Application Layer:
1. Creates infrastructure adapters
2. Calls Ports.getInstance().inject(PortClass, adapter)
3. Repeats for all required adapters

Domain Layer:
1. Calls Ports.resolve(PortClass) when needed
2. Receives properly configured adapter
3. Uses adapter through port interface
</code></pre>
<h1 id="thread-safety-and-concurrency">Thread Safety and
Concurrency</h1>
<h2 id="concurrent-access-safety">Concurrent Access Safety</h2>
<p>The Ports class handles concurrent access through multiple
mechanisms:</p>
<ul>
<li><strong>Volatile singleton instance</strong>: Ensures visibility
across threads</li>
<li><strong>Double-checked locking</strong>: Prevents race conditions
during initialization</li>
<li><strong>Inherited caching</strong>: Thread-safe adapter caching from
CachingPortResolver</li>
<li><strong>Immutable resolution</strong>: Port resolution doesn't
modify state</li>
</ul>
<h2 id="performance-characteristics">Performance Characteristics</h2>
<ul>
<li><strong>First access</strong>: May require synchronization for
singleton creation</li>
<li><strong>Subsequent access</strong>: Lock-free singleton access</li>
<li><strong>Port resolution</strong>: Cached for optimal
performance</li>
<li><strong>Injection operations</strong>: Synchronized at
implementation map level</li>
</ul>
<h1 id="testing-support">Testing Support</h1>
<h2 id="test-friendly-design">Test-Friendly Design</h2>
<p>The Ports infrastructure supports comprehensive testing
strategies:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Unit testing with mock adapters</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldProcessEventSuccessfully</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Mock adapter injected</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    EventEmitterPort mockEmitter <span class="op">=</span> <span class="fu">mock</span><span class="op">(</span>EventEmitterPort<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    Ports<span class="op">.</span><span class="fu">getInstance</span><span class="op">().</span><span class="fu">inject</span><span class="op">(</span>EventEmitterPort<span class="op">.</span><span class="fu">class</span><span class="op">,</span> mockEmitter<span class="op">);</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Domain logic executes</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    domainService<span class="op">.</span><span class="fu">processEvent</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Verify interactions</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">verify</span><span class="op">(</span>mockEmitter<span class="op">).</span><span class="fu">emit</span><span class="op">(</span><span class="fu">any</span><span class="op">(</span>DomainEvent<span class="op">.</span><span class="fu">class</span><span class="op">));</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="test-isolation">Test Isolation</h2>
<p>Tests can inject specific adapters for isolated testing:</p>
<ul>
<li>Mock adapters for unit tests</li>
<li>In-memory adapters for integration tests</li>
<li>Test-specific adapters for scenario testing</li>
</ul>
<h1 id="error-handling-and-diagnostics">Error Handling and
Diagnostics</h1>
<h2 id="runtime-exception-strategy">Runtime Exception Strategy</h2>
<p>When port resolution fails, the system provides clear diagnostic
information:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">throw</span> <span class="kw">new</span> <span class="bu">RuntimeException</span><span class="op">(</span><span class="st">&quot;No implementation found for port: &quot;</span> <span class="op">+</span> port<span class="op">.</span><span class="fu">getName</span><span class="op">());</span></span></code></pre></div>
<h2 id="common-resolution-failures">Common Resolution Failures</h2>
<ul>
<li><strong>Missing Adapter</strong>: Application layer failed to
register required adapter</li>
<li><strong>Initialization Order</strong>: Port accessed before
application initialization</li>
<li><strong>Configuration Issues</strong>: Adapter instantiation or
injection failures</li>
</ul>
<h2 id="diagnostic-information">Diagnostic Information</h2>
<p>Error messages include:</p>
<ul>
<li>Exact port interface class name</li>
<li>Clear indication that no implementation was found</li>
<li>Stack trace showing resolution attempt location</li>
</ul>
<h1 id="architectural-benefits">Architectural Benefits</h1>
<h2 id="domain-purity">Domain Purity</h2>
<p>The Ports infrastructure enables pure domain design:</p>
<ul>
<li>Domain objects contain no infrastructure dependencies</li>
<li>Business logic remains technology-agnostic</li>
<li>Testing requires no infrastructure setup</li>
<li>Domain can evolve independently of infrastructure</li>
</ul>
<h2 id="infrastructure-flexibility">Infrastructure Flexibility</h2>
<p>Infrastructure can be modified without domain changes:</p>
<ul>
<li>Swap file system monitoring implementations</li>
<li>Change event storage mechanisms</li>
<li>Upgrade instrumentation approaches</li>
<li>Add new infrastructure capabilities</li>
</ul>
<h2 id="testing-excellence">Testing Excellence</h2>
<p>Clean separation enables superior testing:</p>
<ul>
<li>Unit tests run without infrastructure</li>
<li>Integration tests use real or test adapters</li>
<li>End-to-end tests exercise full stack</li>
<li>Performance tests can isolate layers</li>
</ul>
<h1 id="configuration-and-extensibility">Configuration and
Extensibility</h1>
<h2 id="dynamic-adapter-registration">Dynamic Adapter Registration</h2>
<p>New adapters can be registered at runtime:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Custom adapter registration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> CustomPort customAdapter <span class="op">=</span> <span class="kw">new</span> <span class="fu">CustomPortAdapter</span><span class="op">();</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Ports<span class="op">.</span><span class="fu">getInstance</span><span class="op">().</span><span class="fu">inject</span><span class="op">(</span>CustomPort<span class="op">.</span><span class="fu">class</span><span class="op">,</span> customAdapter<span class="op">);</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Domain can immediately use new capability</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> CustomPort custom <span class="op">=</span> Ports<span class="op">.</span><span class="fu">resolve</span><span class="op">(</span>CustomPort<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span></code></pre></div>
<h2 id="multiple-adapter-support">Multiple Adapter Support</h2>
<p>The infrastructure supports multiple adapters per port:</p>
<ul>
<li>First registered adapter becomes primary</li>
<li>Additional adapters available through <code>_resolveAll</code>
method</li>
<li>Enables adapter composition and fallback strategies</li>
</ul>
<h1 id="performance-optimization">Performance Optimization</h1>
<h2 id="caching-strategy">Caching Strategy</h2>
<p>Inherited from CachingPortResolver:</p>
<ul>
<li>Adapter instances cached after first resolution</li>
<li>No repeated instantiation overhead</li>
<li>Memory-efficient adapter reuse</li>
<li>Configurable cache eviction policies</li>
</ul>
<h2 id="resolution-efficiency">Resolution Efficiency</h2>
<p>Optimized for high-frequency domain usage:</p>
<ul>
<li>Minimal overhead after initialization</li>
<li>Type-safe casting with compile-time verification</li>
<li>Exception-based error handling for fail-fast behavior</li>
</ul>
<h1 id="future-evolution">Future Evolution</h1>
<h2 id="anticipated-enhancements">Anticipated Enhancements</h2>
<ul>
<li>Configuration-driven adapter selection</li>
<li>Plugin architecture for dynamic adapter loading</li>
<li>Metrics and monitoring for port usage</li>
<li>Health checks for adapter availability</li>
</ul>
<h2 id="backwards-compatibility">Backwards Compatibility</h2>
<p>The static resolution interface ensures:</p>
<ul>
<li>Domain code remains unchanged during infrastructure evolution</li>
<li>New port types can be added without affecting existing
functionality</li>
<li>Adapter improvements don't require domain modifications</li>
</ul>
<h1 id="related-documentation">Related Documentation</h1>
<ul>
<li><a
href="../java-commons/docs/CachingPortResolver.org">CachingPortResolver</a>:
Base caching implementation</li>
<li><a href="./ports/ConfigurationPort.org">ConfigurationPort</a>:
Configuration access interface</li>
<li><a href="./ports/EventEmitterPort.org">EventEmitterPort</a>: Event
emission interface</li>
<li><a href="./ByteHotApplication.org">ByteHotApplication</a>: Adapter
discovery and injection</li>
<li><a href="../flows/port-resolution-flow.org">Port Resolution
Flow</a>: Complete resolution process</li>
</ul>
<h1 id="invariants-and-constraints">Invariants and Constraints</h1>
<h2 id="resolution-invariants">Resolution Invariants</h2>
<ul>
<li>Port resolution must be deterministic for the same port
interface</li>
<li>Registered adapters must implement the requested port interface</li>
<li>Resolution must succeed for all adapters registered by the
application layer</li>
</ul>
<h2 id="injection-constraints">Injection Constraints</h2>
<ul>
<li>Only the application layer should perform adapter injection</li>
<li>Adapters must be properly configured before injection</li>
<li>Duplicate adapter registration should be prevented</li>
</ul>
<h2 id="thread-safety-guarantees">Thread Safety Guarantees</h2>
<ul>
<li>Singleton instance creation is thread-safe</li>
<li>Port resolution is safe for concurrent access</li>
<li>Adapter injection should occur during application initialization
only</li>
</ul>
<p>The Ports class represents the foundational infrastructure that makes
ByteHot's clean architecture possible, enabling domain purity while
providing access to essential infrastructure capabilities.</p>
</main>
<div class="footer">
    ByteHot - Revolutionary JVM Hot-Swapping | 
    <a href="https://github.com/rydnr/bytehot">GitHub</a> | 
    <a href="https://rydnr.github.io/bytehot/docs/">Documentation</a> | 
    <a href="https://rydnr.github.io/bytehot/javadocs/">API Docs</a>
</div>
</body></html>
