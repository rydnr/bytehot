<!DOCTYPE html>
<html>
<head>
    <title>UserId - ByteHot Documentation</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div class="navigation">
    <a href="../index.html">üè† Home</a>
    <a href="../implementation.html">üèóÔ∏è Implementation</a>
    <a href="../journal.html">üìî Journal</a>
    <a href="../docs/">üìö Docs</a>
    <a href="../javadocs/">üìñ Javadocs</a>
    <a href="https://github.com/rydnr/bytehot">üîó GitHub</a>
</div>
<main>
<h1 id="overview">Overview</h1>
<p>The <code>UserId</code> class is a value object representing a unique
user identifier in ByteHot's user management domain, featuring
sophisticated auto-discovery capabilities and intelligent user
identification.</p>
<h1 id="class-responsibilities">Class Responsibilities</h1>
<h2 id="primary-responsibilities">Primary Responsibilities</h2>
<ul>
<li>Provide unique user identification across ByteHot operations</li>
<li>Auto-discover user information from Git configuration and
environment</li>
<li>Generate human-readable display names from various identifier
formats</li>
<li>Support multiple user identification strategies (email, username,
anonymous)</li>
</ul>
<h2 id="secondary-responsibilities">Secondary Responsibilities</h2>
<ul>
<li>Validate user identifier formats and constraints</li>
<li>Extract display names intelligently from email addresses</li>
<li>Provide factory methods for different identification scenarios</li>
<li>Maintain immutability and value object semantics</li>
</ul>
<h1 id="value-object-characteristics">Value Object Characteristics</h1>
<h2 id="immutability">Immutability</h2>
<p>The UserId class is completely immutable:</p>
<ul>
<li>All fields are <code>final</code> and <code>private</code></li>
<li>No mutating methods provided</li>
<li>Thread-safe by design</li>
<li>Supports use as map keys and in sets</li>
</ul>
<h2 id="equality-semantics">Equality Semantics</h2>
<p>Value objects require proper equality:</p>
<ul>
<li>Equality based on value content, not identity</li>
<li>Consistent <code>hashCode()</code> implementation via Lombok</li>
<li>Comparable interface for ordering (if needed)</li>
</ul>
<h2 id="factory-methods">Factory Methods</h2>
<p>Multiple creation strategies supported:</p>
<div class="sourceCode" id="cb1"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/UserId.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> UserId <span class="fu">anonymous</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">UserId</span><span class="op">(</span><span class="st">&quot;anonymous-&quot;</span> <span class="op">+</span> <span class="bu">System</span><span class="op">.</span><span class="fu">currentTimeMillis</span><span class="op">(),</span> <span class="st">&quot;Anonymous User&quot;</span><span class="op">);</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> UserId <span class="fu">fromEmail</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> email<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">UserId</span><span class="op">(</span>email<span class="op">,</span> <span class="fu">extractDisplayNameFromEmail</span><span class="op">(</span>email<span class="op">));</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> UserId <span class="fu">fromGit</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Auto-discover from Git configuration</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">discoverFromGitConfig</span><span class="op">();</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="auto-discovery-capabilities">Auto-Discovery Capabilities</h1>
<h2 id="git-configuration-discovery">Git Configuration Discovery</h2>
<p>The most sophisticated discovery mechanism:</p>
<p>private static UserId discoverFromGitConfig() { try { final Process
gitNameProcess = new ProcessBuilder("git", "config",
"user.name").start(); final Process gitEmailProcess = new
ProcessBuilder("git", "config", "user.email").start();</p>
<p>final String gitName = readProcessOutput(gitNameProcess).trim();
final String gitEmail = readProcessOutput(gitEmailProcess).trim();</p>
<p>if (!gitEmail.isEmpty()) { final String displayName =
!gitName.isEmpty() ? gitName : extractDisplayNameFromEmail(gitEmail);
return new UserId(gitEmail, displayName); } } catch (final IOException |
InterruptedException e) { // Git not available, continue with fallback
}</p>
<p>return fromEnvironment(); }</p>
<h2 id="environment-variable-discovery">Environment Variable
Discovery</h2>
<p>Fallback identification strategy:</p>
<div class="sourceCode" id="cb2"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/UserId.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> UserId <span class="fu">fromEnvironment</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> envVariables <span class="op">=</span> <span class="op">{</span><span class="st">&quot;USER&quot;</span><span class="op">,</span> <span class="st">&quot;USERNAME&quot;</span><span class="op">,</span> <span class="st">&quot;LOGNAME&quot;</span><span class="op">};</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> envVar <span class="op">:</span> envVariables<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">String</span> username <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">getenv</span><span class="op">(</span>envVar<span class="op">);</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>username <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>username<span class="op">.</span><span class="fu">trim</span><span class="op">().</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> <span class="fu">UserId</span><span class="op">(</span>username<span class="op">.</span><span class="fu">trim</span><span class="op">(),</span> <span class="fu">formatDisplayName</span><span class="op">(</span>username<span class="op">.</span><span class="fu">trim</span><span class="op">()));</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">anonymous</span><span class="op">();</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="intelligent-display-name-extraction">Intelligent Display Name
Extraction</h2>
<p>Smart parsing of email addresses:</p>
<p>private static String extractDisplayNameFromEmail(final String email)
{ if (email == null || !email.contains("@")) { return email; }</p>
<p>final String localPart = email.substring(0, email.indexOf("@"));</p>
<p>// Handle common patterns: first.last, first<sub>last</sub>,
firstlast if (localPart.contains(".")) { return
Arrays.stream(localPart.split("\\.")) .map(UserId::capitalize)
.collect(Collectors.joining(" ")); } else if (localPart.contains("<u>"))
{ return Arrays.stream(localPart.split("</u>")) .map(UserId::capitalize)
.collect(Collectors.joining(" ")); } else { return
capitalize(localPart); } }</p>
<h1 id="integration-with-user-management">Integration with User
Management</h1>
<h2 id="aggregate-root-coordination">Aggregate Root Coordination</h2>
<p>UserId serves as the key for User aggregate identification:</p>
<div class="sourceCode" id="cb3"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/UserId.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Used in User aggregate</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> DomainResponseEvent<span class="op">&lt;</span>UserRegistrationRequested<span class="op">&gt;</span> <span class="fu">accept</span><span class="op">(</span><span class="dt">final</span> UserRegistrationRequested event<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> UserProfile profile <span class="op">=</span> UserProfile<span class="op">.</span><span class="fu">defaultProfile</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getUserId</span><span class="op">());</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... rest of registration logic</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="event-metadata-integration">Event Metadata Integration</h2>
<p>User identification propagates through all domain events:</p>
<p>// EventMetadata includes user context final EventMetadata metadata =
createMetadataWithUser( "user", userId.getValue(), previousEventId,
currentVersion, userId.getValue() // User ID for audit trail );</p>
<h1 id="validation-and-security">Validation and Security</h1>
<h2 id="input-validation">Input Validation</h2>
<p>Robust validation of user identifiers:</p>
<div class="sourceCode" id="cb4"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/UserId.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">validateUserId</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>value <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> value<span class="op">.</span><span class="fu">trim</span><span class="op">().</span><span class="fu">isEmpty</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span><span class="op">(</span><span class="st">&quot;User ID cannot be null or empty&quot;</span><span class="op">);</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>value<span class="op">.</span><span class="fu">length</span><span class="op">()</span> <span class="op">&gt;</span> MAX_USER_ID_LENGTH<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span><span class="op">(</span><span class="st">&quot;User ID too long: &quot;</span> <span class="op">+</span> value<span class="op">.</span><span class="fu">length</span><span class="op">());</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Additional validation rules can be added here</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="security-considerations">Security Considerations</h2>
<ul>
<li>No sensitive information stored in plain text</li>
<li>Display names are derived, not stored separately</li>
<li>Git commands executed safely with proper error handling</li>
<li>Environment variables accessed through standard Java APIs</li>
</ul>
<h1 id="performance-optimizations">Performance Optimizations</h1>
<h2 id="lazy-discovery">Lazy Discovery</h2>
<p>Auto-discovery only happens when needed:</p>
<p>public static UserId autoDiscover() { // Expensive discovery only
when explicitly requested return discoverFromGitConfig(); }</p>
<h2 id="caching-strategy">Caching Strategy</h2>
<p>Discovery results can be cached for performance:</p>
<ul>
<li>Static factory methods enable caching at call sites</li>
<li>Immutable objects are safe to cache indefinitely</li>
<li>Discovery process can be optimized for repeated calls</li>
</ul>
<h2 id="memory-efficiency">Memory Efficiency</h2>
<ul>
<li>Minimal memory footprint with only essential fields</li>
<li>String interning for common values (if beneficial)</li>
<li>No unnecessary object references or collections</li>
</ul>
<h1 id="error-handling">Error Handling</h1>
<h2 id="graceful-degradation">Graceful Degradation</h2>
<p>Auto-discovery fails gracefully through fallback chain:</p>
<ol>
<li>Git configuration discovery</li>
<li>Environment variable detection</li>
<li>Anonymous user generation</li>
<li>Never fails completely</li>
</ol>
<h2 id="error-recovery">Error Recovery</h2>
<div class="sourceCode" id="cb5"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/UserId.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">static</span> UserId <span class="fu">fromEnvironment</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Primary environment detection</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">detectFromEnvironment</span><span class="op">();</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="dt">final</span> <span class="bu">Exception</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Log warning but continue with anonymous</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">anonymous</span><span class="op">();</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="exception-safety">Exception Safety</h2>
<ul>
<li>All discovery methods handle exceptions internally</li>
<li>No checked exceptions leak to callers</li>
<li>Consistent fallback behavior across all scenarios</li>
</ul>
<h1 id="testing-strategy">Testing Strategy</h1>
<h2 id="unit-tests">Unit Tests</h2>
<p>Comprehensive testing of all factory methods:</p>
<p>@Test void fromEmail<sub>extractsDisplayNameCorrectly</sub>() { final
UserId userId = UserId.fromEmail("john.doe@example.com");
assertThat(userId.getValue()).isEqualTo("john.doe@example.com");
assertThat(userId.getDisplayName()).isEqualTo("John Doe"); }</p>
<p>@Test void fromGit<sub>discoversFromConfiguration</sub>() { // Mock
Git configuration availability final UserId userId = UserId.fromGit();
assertThat(userId.getValue()).isNotEmpty();
assertThat(userId.getDisplayName()).isNotEmpty(); }</p>
<h2 id="integration-tests">Integration Tests</h2>
<p>Testing auto-discovery in realistic environments:</p>
<ul>
<li>Git repository with valid configuration</li>
<li>Various environment variable scenarios</li>
<li>Network-isolated environments</li>
<li>Permission-restricted environments</li>
</ul>
<h2 id="edge-case-testing">Edge Case Testing</h2>
<p>Comprehensive edge case coverage:</p>
<ul>
<li>Invalid email formats</li>
<li>Missing Git configuration</li>
<li>Empty environment variables</li>
<li>Special characters in usernames</li>
<li>Very long identifiers</li>
</ul>
<h1 id="invariants">Invariants</h1>
<p>The UserId value object maintains several invariants:</p>
<h2 id="value-invariants">Value Invariants</h2>
<ul>
<li>Value string is never null or empty after construction</li>
<li>Display name is always derived from value if not provided</li>
<li>Object equality is based on value content only</li>
</ul>
<h2 id="format-invariants">Format Invariants</h2>
<ul>
<li>Email addresses must contain @ symbol for email-based
identification</li>
<li>Display names are properly formatted (capitalized, spaced)</li>
<li>Anonymous IDs always have unique timestamp suffixes</li>
</ul>
<h2 id="discovery-invariants">Discovery Invariants</h2>
<ul>
<li>Auto-discovery always produces valid UserId instance</li>
<li>Fallback chain ensures no discovery failure</li>
<li>Git discovery respects system Git configuration</li>
</ul>
<h1 id="collaboration-patterns">Collaboration Patterns</h1>
<h2 id="with-user-aggregate">With User Aggregate</h2>
<ul>
<li>Serves as aggregate identifier and lookup key</li>
<li>Used in event reconstruction and state management</li>
<li>Provides user context for all user operations</li>
</ul>
<h2 id="with-domain-events">With Domain Events</h2>
<ul>
<li>Embedded in all user-related domain events</li>
<li>Supports event correlation and audit trails</li>
<li>Enables user-aware event processing</li>
</ul>
<h2 id="with-infrastructure">With Infrastructure</h2>
<ul>
<li>Git command execution through ProcessBuilder</li>
<li>Environment variable access through System.getenv()</li>
<li>File system independence for portability</li>
</ul>
<h1 id="future-enhancements">Future Enhancements</h1>
<h2 id="enhanced-auto-discovery">Enhanced Auto-Discovery</h2>
<ul>
<li>Integration with LDAP/Active Directory</li>
<li>Support for SSH key-based identification</li>
<li>OAuth/OIDC identity provider integration</li>
</ul>
<h2 id="advanced-validation">Advanced Validation</h2>
<ul>
<li>Email format validation with comprehensive regex</li>
<li>Username format enforcement for security</li>
<li>Blacklist/whitelist support for enterprise environments</li>
</ul>
<h2 id="performance-improvements">Performance Improvements</h2>
<ul>
<li>Caching of discovery results</li>
<li>Async discovery for better responsiveness</li>
<li>Batch discovery for multiple users</li>
</ul>
<h2 id="internationalization">Internationalization</h2>
<ul>
<li>Support for international characters in names</li>
<li>Locale-aware display name formatting</li>
<li>Character encoding handling for global use</li>
</ul>
<p>The UserId value object provides the foundation for user
identification in ByteHot, combining simplicity with powerful
auto-discovery capabilities while maintaining strict value object
semantics and architectural boundaries.</p>
</main>
<div class="footer">
    ByteHot - Revolutionary JVM Hot-Swapping | 
    <a href="https://github.com/rydnr/bytehot">GitHub</a> | 
    <a href="https://rydnr.github.io/bytehot/docs/">Documentation</a> | 
    <a href="https://rydnr.github.io/bytehot/javadocs/">API Docs</a>
</div>
</body></html>
