<!DOCTYPE html>
<html>
<head>
    <title>EventMetadata - ByteHot Documentation</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div class="navigation">
    <a href="../index.html">üè† Home</a>
    <a href="../implementation.html">üèóÔ∏è Implementation</a>
    <a href="../journal.html">üìî Journal</a>
    <a href="../docs/">üìö Docs</a>
    <a href="../javadocs/">üìñ Javadocs</a>
    <a href="https://github.com/rydnr/bytehot">üîó GitHub</a>
</div>
<main>
<h1 id="overview">Overview</h1>
<p>The <code>EventMetadata</code> class serves as ByteHot's
comprehensive event sourcing metadata management value object,
encapsulating all essential metadata required for versioned domain
events including aggregate versioning, causal chain tracking, user
context preservation, and correlation support. This critical value
object provides sophisticated factory methods for consistent metadata
generation across different event creation scenarios while maintaining
immutability and complete audit trail capabilities. As the foundational
metadata infrastructure for ByteHot's event-driven architecture, it
ensures consistent event sourcing implementation, enables complete
system state reconstruction, and provides comprehensive support for
debugging, analytics, and compliance requirements throughout the
intelligent hot-swap system lifecycle.</p>
<h1 id="domain-architecture-role">Domain Architecture Role</h1>
<h2 id="event-sourcing-metadata-foundation">Event Sourcing Metadata
Foundation</h2>
<p>EventMetadata serves as the foundational metadata infrastructure for
event sourcing:</p>
<ul>
<li>Encapsulates all essential event sourcing metadata in a cohesive,
immutable value object</li>
<li>Provides consistent metadata generation across all domain events in
the system</li>
<li>Enables complete audit trails and system state reconstruction
through comprehensive versioning</li>
<li>Acts as the cornerstone for event sourcing compliance and best
practices</li>
</ul>
<h2 id="value-object-pattern-implementation">Value Object Pattern
Implementation</h2>
<p>The class exemplifies sophisticated value object design:</p>
<ul>
<li>Immutable design with comprehensive equality and comparison
semantics</li>
<li>Rich factory methods for different metadata creation scenarios and
use cases</li>
<li>Copy-with-modification methods for safe metadata evolution and
updates</li>
<li>Behavioral methods for metadata analysis and validation</li>
</ul>
<h2 id="domain-event-integration-hub">Domain Event Integration Hub</h2>
<p>The implementation serves as the integration hub for domain
events:</p>
<ul>
<li>Used by AbstractVersionedDomainEvent for consistent metadata
management</li>
<li>Provides standardized metadata across all ByteHot domain events</li>
<li>Enables sophisticated event correlation and causal chain
management</li>
<li>Supports comprehensive temporal analysis and debugging
capabilities</li>
</ul>
<h1 id="core-metadata-structure-and-properties">Core Metadata Structure
and Properties</h1>
<h2 id="essential-event-sourcing-properties">Essential Event Sourcing
Properties</h2>
<div class="sourceCode" id="cb1"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Unique identifier for this event instance enabling precise event tracking</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> eventId<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Type of aggregate this event belongs to for aggregate boundary management</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Unique identifier of the aggregate instance for precise aggregate targeting</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Version of this event for the aggregate enabling optimistic concurrency control</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="dt">long</span> aggregateVersion<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Timestamp when the event occurred for temporal analysis and ordering</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> Instant timestamp<span class="op">;</span></span></code></pre></div>
<h2 id="advanced-event-sourcing-metadata">Advanced Event Sourcing
Metadata</h2>
<div class="sourceCode" id="cb2"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> ID of the previous event in this aggregate<span class="co">&#39;</span>s history for causal chain maintenance</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> previousEventId<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Version of the event schema for migration and evolution support</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="dt">int</span> schemaVersion<span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> User who triggered this event for user context and audit trails</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> userId<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Correlation ID for tracing related events across workflows and processes</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="at">@Getter</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> correlationId<span class="op">;</span></span></code></pre></div>
<h2 id="comprehensive-value-object-constructor">Comprehensive Value
Object Constructor</h2>
<div class="sourceCode" id="cb3"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Primary constructor with all event sourcing metadata for complete control</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This constructor enables precise control over all event sourcing aspects</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">eventId</span><span class="co"> </span>unique identifier for this event instance</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateType</span><span class="co"> </span>type of aggregate this event belongs to</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateId</span><span class="co"> </span>unique identifier of the aggregate instance</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateVersion</span><span class="co"> </span>version of this event for the aggregate</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">timestamp</span><span class="co"> </span>when the event occurred</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">previousEventId</span><span class="co"> </span>ID of the previous event in this aggregate<span class="co">&#39;</span>s history</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">schemaVersion</span><span class="co"> </span>version of the event schema for evolution support</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">userId</span><span class="co"> </span>user who triggered this event</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">correlationId</span><span class="co"> </span>correlation ID for tracing related events</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="at">@RequiredArgsConstructor</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> eventId<span class="op">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span> aggregateVersion<span class="op">,</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Instant timestamp<span class="op">,</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> schemaVersion<span class="op">,</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> userId<span class="op">,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> correlationId</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">eventId</span> <span class="op">=</span> eventId<span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateType</span> <span class="op">=</span> aggregateType<span class="op">;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateId</span> <span class="op">=</span> aggregateId<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateVersion</span> <span class="op">=</span> aggregateVersion<span class="op">;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">timestamp</span> <span class="op">=</span> timestamp<span class="op">;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">previousEventId</span> <span class="op">=</span> previousEventId<span class="op">;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">schemaVersion</span> <span class="op">=</span> schemaVersion<span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">userId</span> <span class="op">=</span> userId<span class="op">;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">correlationId</span> <span class="op">=</span> correlationId<span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="factory-methods-and-metadata-creation-strategies">Factory
Methods and Metadata Creation Strategies</h1>
<h2 id="new-aggregate-metadata-creation">New Aggregate Metadata
Creation</h2>
<div class="sourceCode" id="cb4"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates event metadata for a new aggregate with proper initialization for first events</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This is used when creating the first event for a new aggregate instance</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">aggregateType</span><span class="co"> </span>the type of aggregate being created</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateId</span><span class="co"> </span>the unique identifier of the aggregate instance</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> metadata configured for the first event of a new aggregate</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> EventMetadata <span class="fu">forNewAggregate</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">,</span> <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">(),</span>  <span class="co">// Generate unique event ID</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        aggregateType<span class="op">,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        aggregateId<span class="op">,</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1L</span><span class="op">,</span>                           <span class="co">// First version starts at 1</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        Instant<span class="op">.</span><span class="fu">now</span><span class="op">(),</span>               <span class="co">// Current timestamp</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span><span class="op">,</span>                        <span class="co">// No previous event for first event</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span>                           <span class="co">// Default schema version</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span><span class="op">,</span>                        <span class="co">// No user context initially</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span>                         <span class="co">// No correlation initially</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="existing-aggregate-metadata-creation">Existing Aggregate
Metadata Creation</h2>
<div class="sourceCode" id="cb5"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates event metadata for an existing aggregate with proper versioning continuity</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This maintains continuity in the event stream for existing aggregate instances</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">aggregateType</span><span class="co"> </span>the type of aggregate</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateId</span><span class="co"> </span>the unique identifier of the aggregate instance</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">previousEventId</span><span class="co"> </span>the ID of the previous event for causal chain maintenance</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">currentVersion</span><span class="co"> </span>the current version of the aggregate for proper versioning</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> metadata configured for the next event in an existing aggregate<span class="co">&#39;</span>s lifecycle</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> EventMetadata <span class="fu">forExistingAggregate</span><span class="op">(</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span> currentVersion</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">(),</span>    <span class="co">// Generate unique event ID</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        aggregateType<span class="op">,</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        aggregateId<span class="op">,</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        currentVersion <span class="op">+</span> <span class="dv">1</span><span class="op">,</span>              <span class="co">// Increment version for next event</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        Instant<span class="op">.</span><span class="fu">now</span><span class="op">(),</span>                   <span class="co">// Current timestamp</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        previousEventId<span class="op">,</span>                 <span class="co">// Link to previous event</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span>                               <span class="co">// Default schema version</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span><span class="op">,</span>                            <span class="co">// No user context initially</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span>                             <span class="co">// No correlation initially</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="custom-timestamp-metadata-creation">Custom Timestamp Metadata
Creation</h2>
<div class="sourceCode" id="cb6"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates event metadata for an existing aggregate with custom timestamp for precise timing</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables precise temporal control for specific timing requirements</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">aggregateType</span><span class="co"> </span>the type of aggregate</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateId</span><span class="co"> </span>the unique identifier of the aggregate instance</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">previousEventId</span><span class="co"> </span>the ID of the previous event for causal chain maintenance</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">currentVersion</span><span class="co"> </span>the current version of the aggregate</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">timestamp</span><span class="co"> </span>the specific timestamp for this event</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> metadata configured with custom timing information</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> EventMetadata <span class="fu">forExistingAggregate</span><span class="op">(</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span> currentVersion<span class="op">,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> Instant timestamp</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">(),</span>    <span class="co">// Generate unique event ID</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        aggregateType<span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        aggregateId<span class="op">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        currentVersion <span class="op">+</span> <span class="dv">1</span><span class="op">,</span>              <span class="co">// Increment version</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        timestamp<span class="op">,</span>                       <span class="co">// Use provided timestamp</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        previousEventId<span class="op">,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span>                               <span class="co">// Default schema version</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span><span class="op">,</span>                            <span class="co">// No user context initially</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span>                             <span class="co">// No correlation initially</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="user-contextualized-metadata-creation">User-Contextualized
Metadata Creation</h2>
<div class="sourceCode" id="cb7"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates event metadata with comprehensive user context for personalized processing</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables user<span class="co">-</span>specific processing and personalized event handling</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">aggregateType</span><span class="co"> </span>the type of aggregate</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateId</span><span class="co"> </span>the unique identifier of the aggregate instance</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">previousEventId</span><span class="co"> </span>the ID of the previous event <span class="co">(</span>null for first event<span class="co">)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">currentVersion</span><span class="co"> </span>the current version of the aggregate <span class="co">(0</span> for first event<span class="co">)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">userId</span><span class="co"> </span>the user who triggered this event for audit and personalization</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> metadata with user context for personalized event processing</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> EventMetadata <span class="fu">withUser</span><span class="op">(</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span> currentVersion<span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> userId</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">(),</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        aggregateType<span class="op">,</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        aggregateId<span class="op">,</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        currentVersion <span class="op">+</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        Instant<span class="op">.</span><span class="fu">now</span><span class="op">(),</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        previousEventId<span class="op">,</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span>                               <span class="co">// Default schema version</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        userId<span class="op">,</span>                          <span class="co">// Include user context</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">null</span>                             <span class="co">// No correlation yet</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="correlation-enhanced-metadata-creation">Correlation-Enhanced
Metadata Creation</h2>
<div class="sourceCode" id="cb8"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates event metadata with correlation for cross<span class="co">-</span>workflow tracking and distributed tracing</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables sophisticated event correlation and distributed tracing capabilities</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">aggregateType</span><span class="co"> </span>the type of aggregate</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">aggregateId</span><span class="co"> </span>the unique identifier of the aggregate instance</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">previousEventId</span><span class="co"> </span>the ID of the previous event <span class="co">(</span>null for first event<span class="co">)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">currentVersion</span><span class="co"> </span>the current version of the aggregate <span class="co">(0</span> for first event<span class="co">)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">userId</span><span class="co"> </span>the user who triggered this event</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">correlationId</span><span class="co"> </span>the correlation ID for tracing related events across workflows</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> metadata with correlation support for distributed tracing and analysis</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> EventMetadata <span class="fu">withCorrelation</span><span class="op">(</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateType<span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> aggregateId<span class="op">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span> currentVersion<span class="op">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> userId<span class="op">,</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> correlationId</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">UUID</span><span class="op">.</span><span class="fu">randomUUID</span><span class="op">().</span><span class="fu">toString</span><span class="op">(),</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        aggregateType<span class="op">,</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        aggregateId<span class="op">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        currentVersion <span class="op">+</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        Instant<span class="op">.</span><span class="fu">now</span><span class="op">(),</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        previousEventId<span class="op">,</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span>                               <span class="co">// Default schema version</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        userId<span class="op">,</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        correlationId                    <span class="co">// Include correlation for tracing</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="metadata-modification-and-evolution-support">Metadata
Modification and Evolution Support</h1>
<h2 id="version-management-and-updates">Version Management and
Updates</h2>
<div class="sourceCode" id="cb9"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates a copy of this metadata with a different version for versioning scenarios</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables event versioning and migration capabilities in event sourcing systems</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">newVersion</span><span class="co"> </span>the new aggregate version for the updated metadata</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> new metadata instance with updated version information</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> EventMetadata <span class="fu">withVersion</span><span class="op">(</span><span class="dt">final</span> <span class="dt">long</span> newVersion<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">eventId</span><span class="op">,</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateType</span><span class="op">,</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateId</span><span class="op">,</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        newVersion<span class="op">,</span>                      <span class="co">// Updated version</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">timestamp</span><span class="op">,</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">previousEventId</span><span class="op">,</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">schemaVersion</span><span class="op">,</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">userId</span><span class="op">,</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">correlationId</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="user-context-management">User Context Management</h2>
<div class="sourceCode" id="cb10"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates a copy of this metadata with user context for personalization scenarios</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables adding user context to existing metadata for audit and personalization</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">userId</span><span class="co"> </span>the user ID to set for user context and audit trails</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> new metadata instance with user context information</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> EventMetadata <span class="fu">withUserId</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> userId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">eventId</span><span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateType</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateId</span><span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateVersion</span><span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">timestamp</span><span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">previousEventId</span><span class="op">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">schemaVersion</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        userId<span class="op">,</span>                          <span class="co">// Updated user context</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">correlationId</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="correlation-management-for-distributed-tracing">Correlation
Management for Distributed Tracing</h2>
<div class="sourceCode" id="cb11"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Creates a copy of this metadata with correlation ID for distributed tracing</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables adding correlation information for cross<span class="co">-</span>workflow event tracking</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="an">correlationId</span><span class="co"> </span>the correlation ID to set for distributed tracing and analysis</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="an">@return</span> new metadata instance with correlation information</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> EventMetadata <span class="fu">withCorrelationId</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> correlationId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">EventMetadata</span><span class="op">(</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">eventId</span><span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateType</span><span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateId</span><span class="op">,</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">aggregateVersion</span><span class="op">,</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">timestamp</span><span class="op">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">previousEventId</span><span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">schemaVersion</span><span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">userId</span><span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        correlationId                    <span class="co">// Updated correlation for tracing</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="metadata-analysis-and-validation-methods">Metadata Analysis and
Validation Methods</h1>
<h2 id="event-lifecycle-analysis">Event Lifecycle Analysis</h2>
<div class="sourceCode" id="cb12"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Checks if this is metadata for the first event of an aggregate lifecycle</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables special handling for aggregate initialization and first<span class="co">-</span>event scenarios</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span> true if this represents the first event in an aggregate<span class="co">&#39;</span>s lifecycle</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isFirstEvent</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> aggregateVersion <span class="op">==</span> <span class="dv">1L</span> <span class="op">&amp;&amp;</span> previousEventId <span class="op">==</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="context-availability-analysis">Context Availability
Analysis</h2>
<div class="sourceCode" id="cb13"
data-tangle="../bytehot/src/main/java/org/acmsl/bytehot/domain/EventMetadata.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Checks if this metadata has user context for personalization and audit scenarios</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables conditional processing based on user context availability</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span> true if user ID is present and available for processing</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">hasUser</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> userId <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>userId<span class="op">.</span><span class="fu">trim</span><span class="op">().</span><span class="fu">isEmpty</span><span class="op">();</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Checks if this metadata has correlation information for distributed tracing</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> This enables conditional correlation and tracing based on correlation availability</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span> true if correlation ID is present and available for tracing</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">hasCorrelation</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correlationId <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>correlationId<span class="op">.</span><span class="fu">trim</span><span class="op">().</span><span class="fu">isEmpty</span><span class="op">();</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="integration-with-event-sourcing-architecture">Integration with
Event Sourcing Architecture</h1>
<h2 id="aggregate-versioning-and-concurrency-control">Aggregate
Versioning and Concurrency Control</h2>
<p>The EventMetadata provides comprehensive support for aggregate
versioning:</p>
<ul>
<li><strong><strong>Optimistic Concurrency</strong></strong>: Version
numbers enable optimistic concurrency control</li>
<li><strong><strong>Causal Chain Maintenance</strong></strong>: Previous
event IDs maintain complete causal relationships</li>
<li><strong><strong>Event Ordering</strong></strong>: Timestamps and
versions provide multiple ordering mechanisms</li>
<li><strong><strong>Conflict Detection</strong></strong>: Version
conflicts can be detected and resolved appropriately</li>
</ul>
<h2 id="event-store-integration">Event Store Integration</h2>
<p>The metadata integrates seamlessly with event storage:</p>
<ul>
<li><strong><strong>Event Identification</strong></strong>: Unique event
IDs for precise event storage and retrieval</li>
<li><strong><strong>Aggregate Querying</strong></strong>: Aggregate type
and ID enable efficient event querying</li>
<li><strong><strong>Version-Based Retrieval</strong></strong>: Support
for version-based event filtering and retrieval</li>
<li><strong><strong>Temporal Querying</strong></strong>: Timestamp-based
querying for temporal analysis</li>
</ul>
<h2 id="cross-cutting-concerns-support">Cross-Cutting Concerns
Support</h2>
<p>The implementation supports various cross-cutting concerns:</p>
<ul>
<li><strong><strong>User Auditing</strong></strong>: User context for
comprehensive audit trails and compliance</li>
<li><strong><strong>Distributed Tracing</strong></strong>: Correlation
IDs for sophisticated distributed system tracing</li>
<li><strong><strong>Schema Evolution</strong></strong>: Schema
versioning for long-term event compatibility</li>
<li><strong><strong>Analytics and Monitoring</strong></strong>: Rich
metadata for comprehensive system analytics</li>
</ul>
<h1 id="performance-optimization-and-memory-management">Performance
Optimization and Memory Management</h1>
<h2 id="memory-efficiency-strategies">Memory Efficiency Strategies</h2>
<p>The implementation optimizes memory usage:</p>
<ul>
<li><strong><strong>Immutable Design</strong></strong>: Prevents memory
leaks through immutable value object design</li>
<li><strong><strong>Efficient String Storage</strong></strong>:
Optimized string storage for identifiers and metadata</li>
<li><strong><strong>Primitive Optimization</strong></strong>: Efficient
storage of numeric values to minimize boxing</li>
<li><strong><strong>Copy-on-Write</strong></strong>: Safe
copy-with-modification patterns for memory efficiency</li>
</ul>
<h2 id="factory-method-optimization">Factory Method Optimization</h2>
<p>The factory methods provide optimized object creation:</p>
<ul>
<li><strong><strong>UUID Generation</strong></strong>: Efficient UUID
generation for unique identifiers</li>
<li><strong><strong>Timestamp Optimization</strong></strong>: Optimized
timestamp generation and handling</li>
<li><strong><strong>Default Value Handling</strong></strong>:
Intelligent default value management for optional fields</li>
<li><strong><strong>Parameter Validation</strong></strong>: Efficient
parameter validation for factory methods</li>
</ul>
<h2 id="serialization-and-storage-optimization">Serialization and
Storage Optimization</h2>
<p>The design supports efficient serialization:</p>
<ul>
<li><strong><strong>Clean Structure</strong></strong>: Well-organized
fields for efficient serialization</li>
<li><strong><strong>Version Compatibility</strong></strong>: Schema
versioning supports serialization evolution</li>
<li><strong><strong>Compact Representation</strong></strong>: Efficient
field organization for serialization optimization</li>
<li><strong><strong>Type Safety</strong></strong>: Strong typing
prevents serialization errors and data corruption</li>
</ul>
<h1 id="testing-and-validation-strategies">Testing and Validation
Strategies</h1>
<h2 id="factory-method-testing">Factory Method Testing</h2>
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldCreateMetadataForNewAggregate</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Aggregate type and ID</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> aggregateType <span class="op">=</span> <span class="st">&quot;filewatch&quot;</span><span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> aggregateId <span class="op">=</span> <span class="st">&quot;/project/classes/Service.class&quot;</span><span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Creating metadata for new aggregate</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    EventMetadata metadata <span class="op">=</span> EventMetadata<span class="op">.</span><span class="fu">forNewAggregate</span><span class="op">(</span>aggregateType<span class="op">,</span> aggregateId<span class="op">);</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Should have correct initial values</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getAggregateType</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>aggregateType<span class="op">);</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getAggregateId</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>aggregateId<span class="op">);</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getAggregateVersion</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span><span class="dv">1L</span><span class="op">);</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">getPreviousEventId</span><span class="op">()).</span><span class="fu">isNull</span><span class="op">();</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>metadata<span class="op">.</span><span class="fu">isFirstEvent</span><span class="op">()).</span><span class="fu">isTrue</span><span class="op">();</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="metadata-evolution-testing">Metadata Evolution Testing</h2>
<div class="sourceCode" id="cb15"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldSupportMetadataEvolution</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Initial metadata</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    EventMetadata original <span class="op">=</span> EventMetadata<span class="op">.</span><span class="fu">forNewAggregate</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">,</span> <span class="st">&quot;id&quot;</span><span class="op">);</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> userId <span class="op">=</span> <span class="st">&quot;developer123&quot;</span><span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> correlationId <span class="op">=</span> <span class="st">&quot;trace-456&quot;</span><span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Adding user and correlation context</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    EventMetadata withUser <span class="op">=</span> original<span class="op">.</span><span class="fu">withUserId</span><span class="op">(</span>userId<span class="op">);</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    EventMetadata withCorrelation <span class="op">=</span> withUser<span class="op">.</span><span class="fu">withCorrelationId</span><span class="op">(</span>correlationId<span class="op">);</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Should preserve original data while adding new context</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>withCorrelation<span class="op">.</span><span class="fu">getEventId</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>original<span class="op">.</span><span class="fu">getEventId</span><span class="op">());</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>withCorrelation<span class="op">.</span><span class="fu">getUserId</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>userId<span class="op">);</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>withCorrelation<span class="op">.</span><span class="fu">getCorrelationId</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>correlationId<span class="op">);</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>withCorrelation<span class="op">.</span><span class="fu">hasUser</span><span class="op">()).</span><span class="fu">isTrue</span><span class="op">();</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>withCorrelation<span class="op">.</span><span class="fu">hasCorrelation</span><span class="op">()).</span><span class="fu">isTrue</span><span class="op">();</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="causal-chain-testing">Causal Chain Testing</h2>
<div class="sourceCode" id="cb16"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldMaintainCausalChain</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: First event metadata</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    EventMetadata first <span class="op">=</span> EventMetadata<span class="op">.</span><span class="fu">forNewAggregate</span><span class="op">(</span><span class="st">&quot;test&quot;</span><span class="op">,</span> <span class="st">&quot;id&quot;</span><span class="op">);</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Creating second event metadata</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    EventMetadata second <span class="op">=</span> EventMetadata<span class="op">.</span><span class="fu">forExistingAggregate</span><span class="op">(</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;test&quot;</span><span class="op">,</span> <span class="st">&quot;id&quot;</span><span class="op">,</span> first<span class="op">.</span><span class="fu">getEventId</span><span class="op">(),</span> first<span class="op">.</span><span class="fu">getAggregateVersion</span><span class="op">());</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Should maintain proper causal chain</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>second<span class="op">.</span><span class="fu">getPreviousEventId</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>first<span class="op">.</span><span class="fu">getEventId</span><span class="op">());</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>second<span class="op">.</span><span class="fu">getAggregateVersion</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span><span class="dv">2L</span><span class="op">);</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>second<span class="op">.</span><span class="fu">isFirstEvent</span><span class="op">()).</span><span class="fu">isFalse</span><span class="op">();</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="related-documentation">Related Documentation</h1>
<ul>
<li><span class="spurious-link"
target="AbstractVersionedDomainEvent.org"><em>AbstractVersionedDomainEvent</em></span>:
Primary user of EventMetadata for domain events</li>
<li><span class="spurious-link"
target="EventStorePort.org"><em>EventStorePort</em></span>: Storage
interface that works with EventMetadata</li>
<li><span class="spurious-link"
target="events/ClassFileChanged.org"><em>ClassFileChanged</em></span>:
Example domain event using EventMetadata</li>
<li><span class="spurious-link"
target="flows/event-sourcing-persistence-flow.org"><em>Event Sourcing
Persistence Flow</em></span>: Complete metadata lifecycle
documentation</li>
</ul>
<h1 id="implementation-notes">Implementation Notes</h1>
<h2 id="design-patterns-applied">Design Patterns Applied</h2>
<p>The metadata class leverages several sophisticated design
patterns:</p>
<ul>
<li><strong><strong>Value Object Pattern</strong></strong>: Immutable
design with comprehensive equality and comparison</li>
<li><strong><strong>Factory Method Pattern</strong></strong>: Multiple
factory methods for different creation scenarios</li>
<li><strong><strong>Builder Pattern</strong></strong>:
Copy-with-modification methods for safe evolution</li>
<li><strong><strong>Template Method Pattern</strong></strong>:
Consistent metadata generation across different scenarios</li>
</ul>
<h2 id="domain-driven-design-principles">Domain-Driven Design
Principles</h2>
<p>The implementation follows strict DDD principles:</p>
<ul>
<li><strong><strong>Rich Value Objects</strong></strong>: Meaningful
behavior beyond simple data containers</li>
<li><strong><strong>Immutable Design</strong></strong>: Value object
immutability for consistency and safety</li>
<li><strong><strong>Factory Encapsulation</strong></strong>: Complex
creation logic encapsulated in factory methods</li>
<li><strong><strong>Domain Language</strong></strong>: Clear,
business-focused naming and comprehensive documentation</li>
</ul>
<h2 id="future-enhancement-opportunities">Future Enhancement
Opportunities</h2>
<p>The design supports future enhancements:</p>
<ul>
<li><strong><strong>Advanced Correlation</strong></strong>: Machine
learning-based event correlation and pattern recognition</li>
<li><strong><strong>Performance Analytics</strong></strong>: Built-in
performance monitoring and optimization capabilities</li>
<li><strong><strong>Schema Evolution</strong></strong>: Advanced schema
migration and compatibility management</li>
<li><strong><strong>Distributed Metadata</strong></strong>: Enhanced
distributed tracing and observability integration</li>
</ul>
<p>The EventMetadata provides ByteHot's essential event sourcing
metadata foundation while maintaining clean value object design,
comprehensive functionality, and extensibility for advanced event
sourcing scenarios throughout the entire intelligent event-driven system
lifecycle.</p>
</main>
<div class="footer">
    ByteHot - Revolutionary JVM Hot-Swapping | 
    <a href="https://github.com/rydnr/bytehot">GitHub</a> | 
    <a href="https://rydnr.github.io/bytehot/docs/">Documentation</a> | 
    <a href="https://rydnr.github.io/bytehot/javadocs/">API Docs</a>
</div>
</body></html>
