#+TITLE: ByteHot Maven Plugin User Guide
#+AUTHOR: ByteHot Team
#+DATE: 2025-06-27

* Overview

The ByteHot Maven Plugin integrates hot-swapping capabilities directly into your Maven build lifecycle. This plugin automatically monitors your Java classes for changes and applies bytecode updates to running JVM instances without requiring application restarts.

** Key Features

- Seamless integration with Maven build lifecycle
- Automatic class change detection during development
- Zero-configuration setup for standard Maven projects
- Support for multi-module Maven projects
- Integration with popular IDEs and development workflows
- Real-time feedback on hot-swap operations

* Installation

** Prerequisites

- Java 17 or higher
- Maven 3.8.0 or higher
- A running Java application with ByteHot agent attached

** Adding the Plugin to Your Project

Add the ByteHot Maven plugin to your project's =pom.xml=:

#+BEGIN_SRC xml
<project>
  <build>
    <plugins>
      <plugin>
        <groupId>org.acmsl</groupId>
        <artifactId>bytehot-maven-plugin</artifactId>
        <version>latest-SNAPSHOT</version>
        <configuration>
          <!-- Optional configuration -->
          <watchPaths>
            <watchPath>src/main/java</watchPath>
            <watchPath>src/main/resources</watchPath>
          </watchPaths>
          <agentPort>8080</agentPort>
          <hotSwapEnabled>true</hotSwapEnabled>
        </configuration>
        <executions>
          <execution>
            <goals>
              <goal>watch</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project>
#+END_SRC

** Alternative: Using Maven Plugin Repository

If you prefer to use the plugin without modifying your =pom.xml=:

#+BEGIN_SRC bash
mvn org.acmsl:bytehot-maven-plugin:watch
#+END_SRC

* Configuration

** Basic Configuration

The plugin works with zero configuration for standard Maven projects, but you can customize its behavior:

#+BEGIN_SRC xml
<configuration>
  <!-- Directories to monitor for changes -->
  <watchPaths>
    <watchPath>src/main/java</watchPath>
    <watchPath>src/main/resources</watchPath>
    <watchPath>src/test/java</watchPath>
  </watchPaths>
  
  <!-- ByteHot agent connection settings -->
  <agentHost>localhost</agentHost>
  <agentPort>8080</agentPort>
  
  <!-- File patterns to include/exclude -->
  <includes>
    <include>**/*.java</include>
    <include>**/*.class</include>
  </includes>
  <excludes>
    <exclude>**/test/**</exclude>
  </excludes>
  
  <!-- Hot-swap behavior -->
  <hotSwapEnabled>true</hotSwapEnabled>
  <autoRecompile>true</autoRecompile>
  <watchInterval>1000</watchInterval>
  
  <!-- Build integration -->
  <triggerFullBuild>false</triggerFullBuild>
  <skipTests>true</skipTests>
</configuration>
#+END_SRC

** Configuration Properties

| Property | Default | Description |
|----------|---------|-------------|
| =watchPaths= | =src/main/java= | Directories to monitor for changes |
| =agentHost= | =localhost= | ByteHot agent hostname |
| =agentPort= | =8080= | ByteHot agent port |
| =includes= | =**/*.java,**/*.class= | File patterns to include |
| =excludes= | =**/test/**= | File patterns to exclude |
| =hotSwapEnabled= | =true= | Enable/disable hot-swapping |
| =autoRecompile= | =true= | Automatically recompile changed files |
| =watchInterval= | =1000= | File watching interval in milliseconds |
| =triggerFullBuild= | =false= | Trigger full Maven build on changes |
| =skipTests= | =true= | Skip tests during incremental builds |

** Environment Variables

You can also configure the plugin using environment variables:

#+BEGIN_SRC bash
export BYTEHOT_MAVEN_AGENT_HOST=localhost
export BYTEHOT_MAVEN_AGENT_PORT=8080
export BYTEHOT_MAVEN_WATCH_INTERVAL=500
export BYTEHOT_MAVEN_AUTO_RECOMPILE=true
#+END_SRC

* Usage

** Starting Hot-Swap Monitoring

*** Method 1: Maven Goal

#+BEGIN_SRC bash
# Start watching for changes in current project
mvn bytehot:watch

# Watch with custom configuration
mvn bytehot:watch -Dbytehot.agent.port=9090

# Watch in background (detached mode)
mvn bytehot:watch -Dbytehot.daemon=true
#+END_SRC

*** Method 2: Build Lifecycle Integration

If configured in your =pom.xml= executions, the plugin will automatically start monitoring during the =compile= phase:

#+BEGIN_SRC bash
# Regular Maven compile will start ByteHot monitoring
mvn compile

# Development mode with continuous monitoring
mvn compile -Dbytehot.watch.continuous=true
#+END_SRC

** Development Workflow

*** Typical Development Session

1. **Start your application** with ByteHot agent:
   #+BEGIN_SRC bash
   java -javaagent:bytehot-agent.jar -jar your-application.jar
   #+END_SRC

2. **Start Maven monitoring** in a separate terminal:
   #+BEGIN_SRC bash
   mvn bytehot:watch
   #+END_SRC

3. **Edit your Java files** - the plugin will automatically:
   - Detect file changes
   - Recompile modified classes
   - Send bytecode updates to the running application
   - Display hot-swap status

*** IDE Integration

The plugin works seamlessly with popular IDEs:

**** IntelliJ IDEA
- Configure "Build project automatically" in Settings
- Plugin will detect IDE compilation events
- Hot-swap occurs immediately after successful compilation

**** Eclipse
- Enable "Build automatically" in Project menu
- Plugin monitors Eclipse's output directories
- Automatic hot-swap after workspace builds

**** VS Code
- Works with Java Extension Pack
- Monitors language server compilation events
- Integrates with VS Code's task system

** Multi-Module Projects

For Maven multi-module projects, configure the plugin in the parent =pom.xml=:

#+BEGIN_SRC xml
<plugin>
  <groupId>org.acmsl</groupId>
  <artifactId>bytehot-maven-plugin</artifactId>
  <version>latest-SNAPSHOT</version>
  <configuration>
    <multiModuleSupport>true</multiModuleSupport>
    <watchPaths>
      <watchPath>*/src/main/java</watchPath>
    </watchPaths>
  </configuration>
</plugin>
#+END_SRC

Run from parent directory:
#+BEGIN_SRC bash
mvn bytehot:watch -Dbytehot.multi-module=true
#+END_SRC

* Advanced Usage

** Custom Build Integration

*** Pre/Post Hot-Swap Hooks

#+BEGIN_SRC xml
<configuration>
  <preHotSwapCommands>
    <command>echo "Preparing hot-swap..."</command>
    <command>mvn validate</command>
  </preHotSwapCommands>
  <postHotSwapCommands>
    <command>echo "Hot-swap completed!"</command>
    <command>curl -X POST http://localhost:8080/refresh</command>
  </postHotSwapCommands>
</configuration>
#+END_SRC

*** Conditional Hot-Swap

#+BEGIN_SRC xml
<configuration>
  <hotSwapConditions>
    <condition>
      <filePattern>**/Controller.java</filePattern>
      <action>full-restart</action>
    </condition>
    <condition>
      <filePattern>**/Service.java</filePattern>
      <action>hot-swap</action>
    </condition>
  </hotSwapConditions>
</configuration>
#+END_SRC

** Integration with Build Profiles

#+BEGIN_SRC xml
<profiles>
  <profile>
    <id>development</id>
    <properties>
      <bytehot.watch.enabled>true</bytehot.watch.enabled>
      <bytehot.watch.interval>500</bytehot.watch.interval>
    </properties>
  </profile>
  <profile>
    <id>production</id>
    <properties>
      <bytehot.watch.enabled>false</bytehot.watch.enabled>
    </properties>
  </profile>
</profiles>
#+END_SRC

Activate development profile:
#+BEGIN_SRC bash
mvn bytehot:watch -Pdevelopment
#+END_SRC

** Docker Integration

For containerized development:

#+BEGIN_SRC dockerfile
FROM openjdk:17-jdk
COPY target/bytehot-agent.jar /app/
COPY target/your-application.jar /app/
WORKDIR /app
EXPOSE 8080
CMD ["java", "-javaagent:bytehot-agent.jar", "-jar", "your-application.jar"]
#+END_SRC

Mount source directory for hot development:
#+BEGIN_SRC bash
docker run -v $(pwd)/src:/workspace/src \
           -v $(pwd)/target:/workspace/target \
           -p 8080:8080 \
           your-app

# In another terminal
mvn bytehot:watch -Dbytehot.agent.host=localhost
#+END_SRC

* Troubleshooting

** Common Issues

*** Plugin Not Detecting Changes

*Problem*: Files are modified but hot-swap doesn't trigger

*Solutions*:
1. Check if file is in monitored paths:
   #+BEGIN_SRC bash
   mvn bytehot:watch -X  # Enable debug logging
   #+END_SRC

2. Verify file patterns:
   #+BEGIN_SRC xml
   <includes>
     <include>**/*.java</include>
   </includes>
   #+END_SRC

3. Check watch interval:
   #+BEGIN_SRC xml
   <watchInterval>500</watchInterval>  <!-- Faster polling -->
   #+END_SRC

*** Connection Issues

*Problem*: Cannot connect to ByteHot agent

*Solutions*:
1. Verify agent is running:
   #+BEGIN_SRC bash
   curl http://localhost:8080/health
   #+END_SRC

2. Check firewall settings:
   #+BEGIN_SRC bash
   netstat -tulpn | grep 8080
   #+END_SRC

3. Verify configuration:
   #+BEGIN_SRC xml
   <agentHost>localhost</agentHost>
   <agentPort>8080</agentPort>
   #+END_SRC

*** Compilation Errors

*Problem*: Plugin fails to compile changed files

*Solutions*:
1. Check Maven compiler configuration:
   #+BEGIN_SRC xml
   <plugin>
     <groupId>org.apache.maven.plugins</groupId>
     <artifactId>maven-compiler-plugin</artifactId>
     <version>3.11.0</version>
     <configuration>
       <source>17</source>
       <target>17</target>
     </configuration>
   </plugin>
   #+END_SRC

2. Verify classpath:
   #+BEGIN_SRC bash
   mvn dependency:build-classpath
   #+END_SRC

3. Check for circular dependencies:
   #+BEGIN_SRC bash
   mvn dependency:analyze
   #+END_SRC

** Debug Mode

Enable verbose logging:

#+BEGIN_SRC bash
mvn bytehot:watch -X -Dbytehot.debug=true
#+END_SRC

Or add to =pom.xml=:
#+BEGIN_SRC xml
<configuration>
  <debug>true</debug>
  <verbose>true</verbose>
</configuration>
#+END_SRC

** Performance Tuning

For large projects:

#+BEGIN_SRC xml
<configuration>
  <!-- Reduce file system polling -->
  <watchInterval>2000</watchInterval>
  
  <!-- Limit watched directories -->
  <watchPaths>
    <watchPath>src/main/java/com/yourpackage</watchPath>
  </watchPaths>
  
  <!-- Use more specific patterns -->
  <includes>
    <include>**/service/**/*.java</include>
    <include>**/controller/**/*.java</include>
  </includes>
  
  <!-- Enable parallel compilation -->
  <parallelCompilation>true</parallelCompilation>
  <compilationThreads>4</compilationThreads>
</configuration>
#+END_SRC

* Examples

** Basic Web Application

#+BEGIN_SRC xml
<plugin>
  <groupId>org.acmsl</groupId>
  <artifactId>bytehot-maven-plugin</artifactId>
  <version>latest-SNAPSHOT</version>
  <configuration>
    <watchPaths>
      <watchPath>src/main/java</watchPath>
      <watchPath>src/main/resources</watchPath>
    </watchPaths>
    <includes>
      <include>**/*.java</include>
      <include>**/*.properties</include>
      <include>**/*.yml</include>
    </includes>
  </configuration>
</plugin>
#+END_SRC

** Microservices Architecture

#+BEGIN_SRC xml
<plugin>
  <groupId>org.acmsl</groupId>
  <artifactId>bytehot-maven-plugin</artifactId>
  <version>latest-SNAPSHOT</version>
  <configuration>
    <multiModuleSupport>true</multiModuleSupport>
    <agentDiscovery>true</agentDiscovery>
    <serviceDiscovery>
      <consulEnabled>true</consulEnabled>
      <consulHost>localhost</consulHost>
      <consulPort>8500</consulPort>
    </serviceDiscovery>
  </configuration>
</plugin>
#+END_SRC

* Best Practices

** Development Workflow

1. **Start with minimal configuration** - use defaults first
2. **Use development profiles** - separate dev/prod configurations
3. **Monitor specific packages** - avoid watching entire source tree
4. **Use IDE integration** - leverage automatic compilation
5. **Test incrementally** - verify hot-swap with small changes first

** Performance Tips

1. **Exclude test directories** - focus on main source code
2. **Use specific file patterns** - avoid unnecessary file monitoring
3. **Adjust watch intervals** - balance responsiveness vs. CPU usage
4. **Enable parallel compilation** - for multi-core systems
5. **Use SSD storage** - faster file system operations

** Security Considerations

1. **Disable in production** - never enable hot-swap in production
2. **Restrict agent access** - bind to localhost only
3. **Use build profiles** - conditional plugin activation
4. **Monitor agent ports** - ensure no unauthorized access

For more information, see the [[../../technical-specs/plugin-communication-protocol.org][Plugin Communication Protocol]] and [[../../milestone-9-maven-plugin.org][Maven Plugin Specification]].