<!DOCTYPE html>
<html>
<head>
    <title>ClassFileChanged - ByteHot Documentation</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
<h1 id="overview">Overview</h1>
<p>The <code>ClassFileChanged</code> event represents the detection of a
modification to a compiled Java class file on the file system. This is
one of the most fundamental events in ByteHot's architecture, serving as
the primary trigger that initiates the entire hot-swap workflow.</p>
<h1 id="domain-role-and-significance">Domain Role and Significance</h1>
<h2 id="primary-domain-event">Primary Domain Event</h2>
<p>As a critical domain event, ClassFileChanged serves as the entry
point for ByteHot's hot-swap capabilities. When a developer recompiles
their Java code, this event captures the precise moment when the new
bytecode becomes available for potential hot-swapping.</p>
<h2 id="event-driven-architecture-position">Event-Driven Architecture
Position</h2>
<p>This event occupies a crucial position in the event chain:</p>
<ol>
<li><strong>File System Monitoring</strong> detects changes →
<code>ClassFileChanged</code></li>
<li><code>ClassFileChanged</code> triggers →
<code>ClassMetadataExtracted</code></li>
<li>Metadata extraction leads to → <code>BytecodeValidated</code></li>
<li>Validation success enables → <code>HotSwapRequested</code></li>
</ol>
<h2 id="eventsourcing-foundation">EventSourcing Foundation</h2>
<p>ClassFileChanged events form the foundational layer of ByteHot's
EventSourcing capabilities, providing:</p>
<ul>
<li>Complete audit trail of all file modifications</li>
<li>Temporal tracking of development activities</li>
<li>User context for collaborative development scenarios</li>
<li>Causal relationship establishment for subsequent events</li>
</ul>
<h1 id="event-structure-and-properties">Event Structure and
Properties</h1>
<h2 id="core-file-information">Core File Information</h2>
<div class="sourceCode" id="cb1"
data-tangle="../../bytehot/src/main/java/org/acmsl/bytehot/domain/events/ClassFileChanged.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> The path to the modified <span class="co">.</span>class file</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Path classFile<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> The name of the class <span class="co">(</span>extracted from filename<span class="co">)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> className<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> The size of the file after modification</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> fileSize<span class="op">;</span></span></code></pre></div>
<h2 id="temporal-context">Temporal Context</h2>
<div class="sourceCode" id="cb2"
data-tangle="../../bytehot/src/main/java/org/acmsl/bytehot/domain/events/ClassFileChanged.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> The timestamp when the change was detected <span class="co">(</span>domain<span class="co">-</span>specific<span class="co">,</span> different from event timestamp<span class="co">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Instant detectionTimestamp<span class="op">;</span></span></code></pre></div>
<p>The distinction between <code>detectionTimestamp</code> and the
inherited event timestamp is crucial:</p>
<ul>
<li><code>detectionTimestamp</code>: When the file system change was
actually detected</li>
<li>Event timestamp: When the domain event was created and
processed</li>
</ul>
<h1 id="event-inheritance-and-architecture">Event Inheritance and
Architecture</h1>
<h2
id="abstractversioneddomainevent-inheritance">AbstractVersionedDomainEvent
Inheritance</h2>
<p>ClassFileChanged extends <code>AbstractVersionedDomainEvent</code>,
inheriting:</p>
<ul>
<li>EventSourcing capabilities with aggregate versioning</li>
<li>Event causality chains through <code>previousEventId</code></li>
<li>User context tracking for collaborative environments</li>
<li>Schema versioning for event evolution</li>
<li>Correlation identifiers for distributed tracing</li>
</ul>
<h2 id="event-metadata-integration">Event Metadata Integration</h2>
<p>The event seamlessly integrates with ByteHot's
<code>EventMetadata</code> system:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EventSourcing metadata automatically includes:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - Unique event identifier</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - Aggregate type (&quot;filewatch&quot;) </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - Aggregate identifier (file path)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - Version sequencing</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - User context</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">// - Causality tracking</span></span></code></pre></div>
<h1 id="factory-methods-and-creation-patterns">Factory Methods and
Creation Patterns</h1>
<h2 id="new-session-creation">New Session Creation</h2>
<p>For the first event in a file monitoring session:</p>
<div class="sourceCode" id="cb4"
data-tangle="../../bytehot/src/main/java/org/acmsl/bytehot/domain/events/ClassFileChanged.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> ClassFileChanged <span class="fu">forNewSession</span><span class="op">(</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    Path classFile<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> className<span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> fileSize<span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    Instant detectionTimestamp</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    EventMetadata metadata <span class="op">=</span> <span class="fu">createMetadataForNewAggregate</span><span class="op">(</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;filewatch&quot;</span><span class="op">,</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">.</span><span class="fu">toString</span><span class="op">()</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">ClassFileChanged</span><span class="op">(</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        className<span class="op">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        fileSize<span class="op">,</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        detectionTimestamp</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="existing-session-continuation">Existing Session
Continuation</h2>
<p>For subsequent events in an ongoing monitoring session:</p>
<div class="sourceCode" id="cb5"
data-tangle="../../bytehot/src/main/java/org/acmsl/bytehot/domain/events/ClassFileChanged.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> ClassFileChanged <span class="fu">forExistingSession</span><span class="op">(</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    Path classFile<span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> className<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> fileSize<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    Instant detectionTimestamp<span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> currentVersion</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    EventMetadata metadata <span class="op">=</span> EventMetadata<span class="op">.</span><span class="fu">forExistingAggregate</span><span class="op">(</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;filewatch&quot;</span><span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">.</span><span class="fu">toString</span><span class="op">(),</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        previousEventId<span class="op">,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        currentVersion<span class="op">,</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        detectionTimestamp</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">ClassFileChanged</span><span class="op">(</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">,</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">,</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        className<span class="op">,</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        fileSize<span class="op">,</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        detectionTimestamp</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="user-aware-creation">User-Aware Creation</h2>
<p>For collaborative environments with explicit user context:</p>
<div class="sourceCode" id="cb6"
data-tangle="../../bytehot/src/main/java/org/acmsl/bytehot/domain/events/ClassFileChanged.java"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> ClassFileChanged <span class="fu">withUser</span><span class="op">(</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    Path classFile<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> className<span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> fileSize<span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    Instant detectionTimestamp<span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> userId<span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> previousEventId<span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> currentVersion</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    EventMetadata metadata <span class="op">=</span> <span class="fu">createMetadataWithUser</span><span class="op">(</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;filewatch&quot;</span><span class="op">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">.</span><span class="fu">toString</span><span class="op">(),</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        previousEventId<span class="op">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        currentVersion<span class="op">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        userId</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">ClassFileChanged</span><span class="op">(</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        metadata<span class="op">,</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        className<span class="op">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        fileSize<span class="op">,</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        detectionTimestamp</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="event-processing-workflow">Event Processing Workflow</h1>
<h2 id="file-system-integration">File System Integration</h2>
<p>The event creation process typically follows this pattern:</p>
<ol>
<li><strong>NIO WatchService</strong> detects file modification</li>
<li><strong>FileWatcherAdapter</strong> validates the change is a
<code>.class</code> file</li>
<li>File metadata is extracted (size, timestamp, class name)</li>
<li>User context is resolved (Git, environment, explicit
configuration)</li>
<li><code>ClassFileChanged</code> event is created with appropriate
factory method</li>
<li>Event is emitted to the domain layer for processing</li>
</ol>
<h2 id="class-name-extraction-logic">Class Name Extraction Logic</h2>
<p>The <code>className</code> field requires careful extraction from the
file path:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Example transformation:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Path: /project/target/classes/com/example/service/UserService.class</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ClassName: com.example.service.UserService</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> className <span class="op">=</span> <span class="fu">extractClassNameFromPath</span><span class="op">(</span>classFile<span class="op">,</span> watchRoot<span class="op">);</span></span></code></pre></div>
<h2 id="file-size-significance">File Size Significance</h2>
<p>The <code>fileSize</code> field serves multiple purposes:</p>
<ul>
<li><strong>Change Detection</strong>: Different sizes indicate
meaningful modifications</li>
<li><strong>Validation Input</strong>: Size changes help determine
compatibility impact</li>
<li><strong>Performance Optimization</strong>: Large files may require
different processing strategies</li>
<li><strong>Audit Trail</strong>: Historical size tracking reveals
development patterns</li>
</ul>
<h1 id="event-consumption-patterns">Event Consumption Patterns</h1>
<h2 id="primary-consumers">Primary Consumers</h2>
<p>The primary consumers of ClassFileChanged events include:</p>
<ul>
<li><strong>ByteHot Aggregate</strong>: Core decision-making entity that
orchestrates responses</li>
<li><strong>ClassMetadataExtractor</strong>: Analyzes bytecode structure
and compatibility</li>
<li><strong>UserStatisticsTracker</strong>: Updates developer
productivity metrics</li>
<li><strong>FlowDetector</strong>: Identifies recurring development
patterns</li>
</ul>
<h2 id="event-filtering-and-routing">Event Filtering and Routing</h2>
<p>Not all ClassFileChanged events trigger hot-swap attempts:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Common filtering criteria:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">// - File must be in configured watch paths</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">// - File must match configured patterns (*.class)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// - File must not be in excluded directories (test/, generated/)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">// - File size must be within reasonable bounds</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">// - File must be readable and valid bytecode</span></span></code></pre></div>
<h2 id="batch-processing-considerations">Batch Processing
Considerations</h2>
<p>Multiple rapid file changes may be batched:</p>
<ul>
<li>Debouncing prevents excessive processing during mass
compilation</li>
<li>Temporal clustering groups related changes</li>
<li>Dependency analysis determines optimal processing order</li>
</ul>
<h1 id="integration-with-hot-swap-pipeline">Integration with Hot-Swap
Pipeline</h1>
<h2 id="validation-gateway">Validation Gateway</h2>
<p>ClassFileChanged events must pass validation before proceeding:</p>
<ul>
<li><strong>File Accessibility</strong>: Can the file be read?</li>
<li><strong>Bytecode Validity</strong>: Is the content valid Java
bytecode?</li>
<li><strong>Class Loading</strong>: Can the class be loaded by the
current JVM?</li>
<li><strong>Hot-Swap Compatibility</strong>: Are the changes compatible
with JVM limitations?</li>
</ul>
<h2 id="state-transition-triggering">State Transition Triggering</h2>
<p>Successful ClassFileChanged processing triggers state
transitions:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Event sequence for successful hot-swap:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ClassFileChanged → ClassMetadataExtracted → BytecodeValidated </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                → HotSwapRequested → ClassRedefinitionSucceeded </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                → InstancesUpdated</span></code></pre></div>
<h2 id="error-handling-integration">Error Handling Integration</h2>
<p>Failed processing generates error events:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Error sequence examples:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ClassFileChanged → <span class="fu">BytecodeRejected</span> <span class="op">(</span>invalid bytecode<span class="op">)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ClassFileChanged → <span class="fu">ClassRedefinitionFailed</span> <span class="op">(</span>JVM rejection<span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ClassFileChanged → <span class="fu">HotSwapCapabilityNix</span> <span class="op">(</span>unsupported changes<span class="op">)</span></span></code></pre></div>
<h1 id="performance-and-optimization">Performance and Optimization</h1>
<h2 id="memory-efficiency">Memory Efficiency</h2>
<ul>
<li>Path objects are lightweight and reusable</li>
<li>String class names are interned for memory optimization</li>
<li>File size is stored as primitive long for efficiency</li>
<li>Instant timestamps use optimal internal representation</li>
</ul>
<h2 id="processing-speed">Processing Speed</h2>
<ul>
<li>Event creation is optimized for minimal latency</li>
<li>File metadata extraction uses NIO for performance</li>
<li>Class name parsing employs efficient string operations</li>
<li>Factory methods minimize object allocation overhead</li>
</ul>
<h2 id="scalability-considerations">Scalability Considerations</h2>
<ul>
<li>Events support high-frequency file change scenarios</li>
<li>Batch processing capabilities handle mass compilation</li>
<li>Memory footprint remains constant regardless of file size</li>
<li>Event queuing prevents memory leaks during processing spikes</li>
</ul>
<h1 id="testing-and-validation">Testing and Validation</h1>
<h2 id="event-creation-testing">Event Creation Testing</h2>
<div class="sourceCode" id="cb11"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldCreateEventForNewSession</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: File change parameters</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    Path classFile <span class="op">=</span> Paths<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="st">&quot;target/classes/com/example/Service.class&quot;</span><span class="op">);</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> className <span class="op">=</span> <span class="st">&quot;com.example.Service&quot;</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> fileSize <span class="op">=</span> <span class="dv">2048L</span><span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    Instant detectionTime <span class="op">=</span> Instant<span class="op">.</span><span class="fu">now</span><span class="op">();</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Event is created</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    ClassFileChanged event <span class="op">=</span> ClassFileChanged<span class="op">.</span><span class="fu">forNewSession</span><span class="op">(</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        classFile<span class="op">,</span> className<span class="op">,</span> fileSize<span class="op">,</span> detectionTime</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Event should contain correct information</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getClassFile</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>classFile<span class="op">);</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getClassName</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>className<span class="op">);</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getFileSize</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>fileSize<span class="op">);</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getDetectionTimestamp</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span>detectionTime<span class="op">);</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>event<span class="op">.</span><span class="fu">getAggregateVersion</span><span class="op">()).</span><span class="fu">isEqualTo</span><span class="op">(</span><span class="dv">1L</span><span class="op">);</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="event-processing-testing">Event Processing Testing</h2>
<div class="sourceCode" id="cb12"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldTriggerHotSwapWorkflow</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Valid class file change</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    ClassFileChanged event <span class="op">=</span> <span class="fu">createValidClassFileChanged</span><span class="op">();</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Event is processed</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    DomainResponseEvent<span class="op">&lt;</span>ClassFileChanged<span class="op">&gt;</span> response <span class="op">=</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        ByteHot<span class="op">.</span><span class="fu">accept</span><span class="op">(</span>event<span class="op">);</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Should trigger metadata extraction</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>response<span class="op">.</span><span class="fu">isSuccessful</span><span class="op">()).</span><span class="fu">isTrue</span><span class="op">();</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>response<span class="op">.</span><span class="fu">getEvents</span><span class="op">())</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">hasSize</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">first</span><span class="op">()</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">isInstanceOf</span><span class="op">(</span>ClassMetadataExtracted<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="integration-testing">Integration Testing</h2>
<div class="sourceCode" id="cb13"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="at">@Test</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="fu">shouldHandleRapidFileChanges</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Given: Multiple rapid file changes</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>ClassFileChanged<span class="op">&gt;</span> rapidChanges <span class="op">=</span> <span class="fu">createRapidFileChanges</span><span class="op">();</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When: Events are processed in sequence</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">List</span><span class="op">&lt;</span>DomainResponseEvent<span class="op">&lt;?&gt;&gt;</span> responses <span class="op">=</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        rapidChanges<span class="op">.</span><span class="fu">stream</span><span class="op">()</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                   <span class="op">.</span><span class="fu">map</span><span class="op">(</span>ByteHot<span class="op">::</span>accept<span class="op">)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                   <span class="op">.</span><span class="fu">collect</span><span class="op">(</span><span class="fu">toList</span><span class="op">());</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then: Should handle all changes without errors</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assertThat</span><span class="op">(</span>responses<span class="op">).</span><span class="fu">allMatch</span><span class="op">(</span>DomainResponseEvent<span class="op">::</span>isSuccessful<span class="op">);</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="related-documentation">Related Documentation</h1>
<ul>
<li><a href="./ClassMetadataExtracted.org">ClassMetadataExtracted</a>:
Next event in the hot-swap chain</li>
<li><a href="./BytecodeValidated.org">BytecodeValidated</a>: Validation
outcome event</li>
<li><a href="../ByteHot.org">ByteHot</a>: Primary aggregate that
processes these events</li>
<li><a
href="../infrastructure/FileWatcherAdapter.org">FileWatcherAdapter</a>:
Infrastructure component that generates these events</li>
<li><a href="../../flows/file-change-detection.org">File Change
Detection Flow</a>: Complete workflow documentation</li>
</ul>
<h1 id="future-evolution">Future Evolution</h1>
<h2 id="anticipated-enhancements">Anticipated Enhancements</h2>
<ul>
<li>Enhanced file type detection beyond <code>.class</code> files</li>
<li>Integration with build tool change notifications</li>
<li>Predictive pre-loading based on change patterns</li>
<li>Advanced filtering based on change impact analysis</li>
</ul>
<h2 id="extensibility-points">Extensibility Points</h2>
<ul>
<li>Custom class name extraction strategies</li>
<li>Pluggable file validation logic</li>
<li>Alternative file monitoring backends</li>
<li>Integration with IDE change notifications</li>
</ul>
<p>The ClassFileChanged event serves as the cornerstone of ByteHot's
reactive architecture, transforming file system changes into structured
domain events that drive intelligent hot-swap decisions.</p>
</body></html>
